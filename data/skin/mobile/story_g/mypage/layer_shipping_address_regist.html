{*** 배송지 등록 | mypage/layer_shipping_address_regist.php ***}

<div class="ly_head">
    <h1 class="h_tit elp">{=__('배송지 등록')}</span></h1>
</div>

<form name="frmDeliveryAddressRegist" id="frmDeliveryAddressRegist" action="../order/layer_shipping_ps.php" method="post">
    <input type="hidden" name="mode" value="{mode}" />
    <input type="hidden" name="sno" value="{data.sno}" />
    <input type="hidden" name="shippingNo" value="{shippingNo}" />
    <div class="form-ui shipping_content">
        <div class="input_wrap">
            <div class="input_title required">{=__('배송지 이름')}</div>
            <div class="input_content">
                <input type="text" name="shippingTitle" id="shippingTitle" value="{data.shippingTitle}" class="input-text wp100"/>
            </div>
        </div>
        <div class="input_wrap">
            <div class="input_title required">{=__('받으실 분')}</div>
            <div class="input_content">
                <input type="text" name="shippingName" id="shippingName" maxlength="20" value="{data.shippingName}" class="input-text wp100"/>
            </div>
        </div>
        <!--{ ? gGlobal.isFront }-->
        <div class="input_wrap">
            <div class="input_title required">{=__('국가')}</div>
            <div class="input_content inp_sel">
                {=gd_select_box('shippingCountryCode', 'shippingCountryCode', countryAddress, null, data.shippingCountryCode, __('=선택해주세요='), null, 'tune select-small')}
            </div>
        </div>
        <div class="input_wrap">
            <div class="input_title">{=__('도시')}</div>
            <div class="input_content">
                <input type="text" name="shippingCity" id="shippingCity" value="{data.shippingCity}" class="input-text wp100"/>
            </div>
        </div>
        <div class="input_wrap">
            <div class="input_title">{=__('주/지방/지역')}</div>
            <div class="input_content">
                <input type="text" name="shippingState" id="shippingState" value="{data.shippingState}" class="input-text wp100"/>
            </div>
        </div>
        <div class="input_wrap">
            <div class="input_title">{=__('주소')}1</div>
            <div class="input_content">
                <input type="text" name="shippingAddress" id="shippingAddress" value="{data.shippingAddress}" class="input-text wp100"/>
            </div>
        </div>
        <div class="input_wrap">
            <div class="input_title">{=__('주소')}2</div>
            <div class="input_content">
                <input type="text" name="shippingAddressSub" id="shippingAddressSub" value="{data.shippingAddressSub}" class="input-text wp100"/>
            </div>
        </div>
        <div class="input_wrap">
            <div class="input_title required">{=__('우편번호')}</div>
            <div class="input_content">
                <input type="text" name="shippingZonecode" id="shippingZonecode" value="{data.shippingZonecode}" class="input-text wp100"/>
            </div>
        </div>
        <!--{ : }-->
        <div class="input_wrap">
            <div class="input_title required">{=__('받으실 곳')}</div>
            <div class="input_content input_address">
                <div class="zipcode-block">
                    <div class="zipcode-flex">
                        <label class="zipcode">
                            <input type="text" class="text" name="shippingZonecode" readonly="readonly" value="{? data.shippingZipcode == ''}{data.shippingZipcode}{:}{data.shippingZonecode}{/}">
                        </label>
                        <input type="hidden" name="shippingZipcode" value="{data.shippingZipcode}">
                    </div>
                    <div class="zipcode-fix">
                        <button class="btn btn_gr post-search" type="button" id="btnPostcode">
                            <em class="h35 arrow">{=__('우편번호')}</em>
                        </button>
                    </div>
                </div>
                <div class="zipcode-block">
                    <input type="text" class="input-text wp100" name="shippingAddress" readonly="readonly" value="{data.shippingAddress}">
                </div>
                <div class="zipcode-block">
                    <input type="text" class="input-text wp100" name="shippingAddressSub" value="{data.shippingAddressSub}">
                </div>
            </div>
        </div>
        <!--{ / }-->
        <div class="input_wrap">
            <div class="input_title">{=__('전화번호')}</div>
            <div class="input_content<!--{ ? gGlobal.isFront }--> inp_sel<!--{ / }-->">
                <!--{ ? gGlobal.isFront }-->
                {=gd_select_box('shippingPhonePrefixCode', 'shippingPhonePrefixCode', countryPhone, null, data.shippingPhonePrefixCode, __('국가코드'), null, 'tune select-small')}
                <!--{ / }-->
                <input type="text" name="shippingPhone" id="shippingPhone" value="{data.shippingPhone}" class="input-text wp100"/>
            </div>
        </div>
        <div class="input_wrap">
            <div class="input_title required">{=__('휴대폰번호')}</div>
            <div class="input_content<!--{ ? gGlobal.isFront }--> inp_sel<!--{ / }-->">
                <!--{ ? gGlobal.isFront }-->
                {=gd_select_box('shippingCellPhonePrefixCode', 'shippingCellPhonePrefixCode', countryPhone, null, data.shippingCellPhonePrefixCode, __('국가코드'), null, 'tune select-small')}
                <!--{ / }-->
                <input type="text" name="shippingCellPhone" id="shippingCellPhone" value="{data.shippingCellPhone}" class="input-text wp100"/>
            </div>
        </div>
        <div class="input_wrap">
            <span class="inp_chk">
                <input type="checkbox" id="defaultFl" name="defaultFl" value="y" class="checkbox sp" <!--{ ? data.defaultFl == 'y' }-->checked="checked" <!--{ ? data.sno || data.defaultFlDisabled == true }-->onclick="return false;"<!--{ / }--><!--{ / }-->>
                <!--{ ? data.defaultFl == 'y' && data.sno }-->
                <input type="hidden" name="tmpDefaultFl" value="{data.defaultFl}">
                <!--{ / }-->
                <label for="defaultFl" class="check-s<!--{ ? data.defaultFl == 'y' }--> on<!--{ / }-->"><b>{=__('기본 배송지로 설정 합니다.')}</b></label>
            </span>
        </div>
    </div>

    <div class="block-pd">
        <ul class="btn_bx">
            <li><button type="button" class="btn_prev btn btn-gray btn_g ly_btn_close">{=__('취 소')}</button></li>
            <li><button type="submit" class="btn_save btn btn-red">{=__('저 장')}</button></li>
        </ul>
    </div>
</form>

<button type="button" class="bn_cls v2 ly_btn_close"><span class="sp">{=__('닫기')}</span></button>

<script type="text/javascript" src="../js/jquery/jquery.serialize.object.js"></script>
<script type="text/javascript">
    $(function(){
        // 우편번호 체크를 위한 알파벳+숫자+띄어쓰기 체크
        $.validator.addMethod( "alphanumeric", function( value, element ) {
            return this.optional( element ) || /^[a-zA-Z0-9\s]+$/i.test( value );
        }, __("알파벳과 숫자로만 구성되어야 합니다.") );

        // 폼체크
        $('#frmDeliveryAddressRegist').validate({
            submitHandler: function(form) {
                var params = $(form).serializeObject();
                $.post(form.action, params, function(data){
                    if(data.code == 200) {
                        alert(data.message);
                        <!--{ ? type == 'order_regist'}-->
                        var shippingNo = '{shippingNo}';
                        $('.tab-btn:eq(' + shippingNo + ') > a[href="#tab2"]').trigger('click');
                        $('#popup-shipping').removeClass('ly_show').empty();
                        $('html, body').css('overflow', 'auto');
                        <!--{ : }-->
                        location.href = location.href.replace(location.hash,"");
                        <!--{ / }-->
                    } else {
                        alert(data.message);
                    }
                });
                return false;
            },
            rules: {
                shippingTitle: 'required',
                shippingName: 'required',
                shippingZipcode: 'required',
                <!--{ ? gGlobal.isFront }-->
                shippingCountryCode: 'required',
                shippingZonecode: {
                    required: true,
                    alphanumeric: true,
                },
                <!--{ / }-->
                shippingAddress: 'required',
                shippingAddressSub: 'required',
                shippingPhone: {
                    maxlength: 14,
                },
                shippingCellPhone:  {
                    required: true,
                    maxlength: 14,
                },
            },
            messages: {
                shippingTitle: "{=__('배송지 이름을 입력하세요')}",
                shippingName: "{=__('받으실 분 이름을 입력하세요')}",
                shippingZipcode: "{=__('우편번호를 입력하세요')}",
                <!--{ ? gGlobal.isFront }-->
                shippingCountryCode: "{=__('국가를 선택하세요.')}",
                shippingZonecode: {
                    required: "{=__('받으실 곳 우편번호 정보를 입력해 주세요.')}",
                    alphanumeric: "{=__('알파벳과 숫자로만 구성되어야 합니다.')}",
                },
                <!--{ / }-->
                shippingAddress: "{=__('주소를 입력하세요')}",
                shippingAddressSub: "{=__('주소를 입력하세요')}",
                shippingPhone: {
                    maxlength: "{=__('전화번호는 14자리 이상 입력하실 수 없습니다.')}"
                },
                shippingCellPhone: {
                    required: "{=__('휴대폰번호를 입력하세요')}",
                    maxlength: "{=__('휴대폰번호는 14자리 이상 입력하실 수 없습니다.')}"
                }
            }
        });

        // 저장
        $('.js-save').click(function(e){

        });

        // 국가 선택
        $('select[name=shippingCountryCode]').change(function(e){
            $('select[name=shippingPhonePrefixCode]').val($('select[name=shippingCountryCode]').val()).trigger('chosen:updated');
            $('select[name=shippingCellPhonePrefixCode]').val($('select[name=shippingCountryCode]').val()).trigger('chosen:updated');
        });

        $('#btnPostcode').click(function (e) {
            e.preventDefault();
            setTimeout(postcodeSearch, 500);
            $('html, body').css('overflow', 'auto');
        });
    });

    var postcodeSearch = function(){
        postcode_search('shippingZonecode', 'shippingAddress', 'shippingZipcode');
    }
</script>
