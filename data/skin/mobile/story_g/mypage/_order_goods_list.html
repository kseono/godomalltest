{*** 마이페이지 주문상품리스트 | mypage/_order_goods_list.php ***}
<!--
{ ? ordersByRegisterDay }
    { @ ordersByRegisterDay }
-->

<!--{ @ .value_ }-->
<!--{ ? pageName == 'list' }-->
<!--{ ? ..goods }-->
<!--{ ? ..orderGoodsCnt > 0 }-->
<h2 class="my_tit v2">{=.key_}
    ({=__('총 %s건', '<strong>' + ..orderGoodsCnt + '</strong>')})
</h2>
<div class="orderlist-wrap">
<!--{ / }-->
<!--{ / }-->
<!--{ / }-->
<!--{ @ ..goods }-->
    <!--{ ? ...index_ == 0 }-->
    <h2 class="my_tit">
        {=__('주문번호')}  <!--{ ? mode === 'refundRegist' || mode === 'backRegist' || mode === 'exchangeRegist'}--><a href="../mypage/order_view.php?orderNo={..orderNo}">{..orderNo}<!--{ : }-->{..orderNo}<!--{ / }--></a>
        <!--{ ? pageName == 'view' }--><span class="order_date">{=.key_}</span><!--{ / }-->
        <!--{ ? mode === 'backRegist' || mode === 'refundRegist' || mode === 'exchangeRegist' }-->
        <div class="hd sub check-claim-btn">
            <button class="write-btn all-check-goods" value="n">{=__('전체선택')}</button>
        </div>
        <!--{ : substr(...orderStatus, 0, 1) == 'o' }-->
        <!--{ ? ..orderChannelFl != 'naverpay' }-->
        <div class="sub claim-btn"><a href="#" order-no="{..orderNo}" class="btn-order-cancel write-btn">{=__('주문취소')}</a></div>
        <!--{ / }-->
        <!--{ : }-->
        <!--{ ? ..orderChannelFl != 'naverpay' }-->
        <!--{ ? ..canRefund == true || ..canBack == true || ..canExchange == true || ..orderSettleButton == true}-->
        <div class="sub claim-btn">
            <!--{ ? ..orderSettleButton == true }-->
            <a href="../mypage/layer_order_settle.php?orderNo={..orderNo}" data-toggle="modal" data-target="#popup-settle" data-type="post" data-cache="false" class="write-btn"><em>{=__('구매확정')}</em></a>
            <!--{ / }-->
            <!--{ ? ..canRefund == true && gd_is_plus_shop(c.PLUSSHOP_CODE_USEREXCHANGE) === true && userHandleFl === true}-->
            <a href="../mypage/layer_order_refund_regist.php?mode=refundRegist&orderNo={..orderNo}&orderGoodsNo={...sno}&orderStatus={...orderStatus}" data-toggle="modal" data-target="#popup-refund" data-type="post" data-cache="false" class="write-btn"><em>{=__('환불신청')}</em></a>
            <!--{ / }-->
            <!--{ ? ..canBack == true && gd_is_plus_shop(c.PLUSSHOP_CODE_USEREXCHANGE) === true && userHandleFl === true}-->
            <a href="../mypage/layer_order_back_regist.php?mode=backRegist&orderNo={..orderNo}&orderGoodsNo={...sno}&orderStatus={...orderStatus}" data-toggle="modal" data-target="#popup-back" data-type="post" data-cache="false" class="write-btn"><em>{=__('반품신청')}</em></a>
            <!--{ / }-->
            <!--{ ? ..canExchange == true && gd_is_plus_shop(c.PLUSSHOP_CODE_USEREXCHANGE) === true && userHandleFl === true }-->
            <a href="../mypage/layer_order_exchange_regist.php?mode=exchangeRegist&orderNo={..orderNo}&orderGoodsNo={...sno}&orderStatus={...orderStatus}" data-toggle="modal" data-target="#popup-exchange" data-type="post" data-cache="false" class="write-btn"><em>{=__('교환신청')}</em></a>
            <!--{ / }-->
        </div>
        <!--{ / }-->
        <!--{ / }-->
        <!--{ / }-->
    </h2>
    <!--{ / }-->

    <!--{ ? ...orderInfoRow }-->
    <h3 class="multi-shipping-tit"><!--{ ? ...orderInfoCd == 1 }-->{=__('메인 배송지')}<!--{ : }-->{=__('추가 배송지')}{=...orderInfoCd - 1}<!--{ / }--></h3>
    <!--{ / }-->
    <ul class="my_goods" data-order-no="{..orderNo}" data-order-goodsno="{..sno}" data-order-status="{...orderStatus}">
        <li>
            <div class="info">
                <a href="<!--{ ? pageName == 'list' }-->../mypage/order_view.php?orderNo={..orderNo}<!--{ : }-->../goods/goods_view.php?goodsNo=<!--{ ? ...goodsType === 'addGoods' }-->{...parentGoodsNo}<!--{ : }-->{...goodsNo}<!--{ / }--><!--{ / }-->">
                    <div class="itemhead">
                        <div class="thmb img">{...goodsImage}</div>
                    </div>
                    <div class="itembody">
                        <!--{ ? ...handleMode === 'z' }-->
                        <div class="exchange_add_info"><span>교환추가</span></div>
                        <!--{ / }-->

                        <span class="elp2">{...goodsNm}</span>
                        <!--
                        { ? ...optionInfo }
                            { @ ...optionInfo }
                        -->
                        <dd class="goods-option">
                            {....value_.optionName} : {....value_.optionValue}
                            <!--{ ? ....value_.optionRealPrice != 0 && optionPriceFl == 'y' }-->
                            (<!--{ ? ....value_.optionRealPrice > 0 }-->+<!--{ / }-->{=gd_global_order_currency_display(....value_.optionRealPrice, null, null)})
                            <!--{ / }-->
                            <!--{ ? ....index_ == ....size_ - 1 && ....value_.deliveryInfoStr != "" }-->
                            <!--{ ? empty(....value_.deliveryInfoStr) === false }-->[{....value_.deliveryInfoStr}]<!--{ / }-->
                            <!--{ / }-->
                        </dd>
                        <!--
                            { / }
                        { / }
                        { ? ...optionTextInfo }
                                { @ ...optionTextInfo }
                        -->
                        <dd class="goods-option">
                            {....value_.optionName} : {....value_.optionValue}
                            <!--{ ? ....value_.optionTextPrice != 0 && optionPriceFl == 'y' }-->
                            (<!--{ ? ....value_.optionTextPrice > 0 }-->+<!--{ / }-->{=gd_global_order_currency_display(....value_.optionTextPrice, null, null)})
                            <!--{ / }-->
                        </dd>
                        <!--
                                { / }
                            { / }
                        -->
                    </div>
                </a>
                <!--{ ? empty(...addGoods) === false }-->
                <div class="add-goods-box">
                    <em class="add-title">{=__('추가상품')}</em>
                    <ul class="add-goods-list">
                        <!--{ @ ...addGoods }-->
                        <li>
                            <div class="add-goods-img">{....goodsImage}</div>
                            <div class="add-goods-content">
                                <span class="title">{....goodsNm}</span>
                                <div class="add-goods-text">
                                    <span class="goods-number">{=__('주문수량')} : <em>{....goodsCnt}</em></span>
                                    <span class="goods-price"><em>{=gd_global_order_currency_display(....goodsPrice, ..exchangeRate, ..currencyPolicy)}</em></span>
                                </div>
                            </div>
                        </li>
                        <!--{ / }-->
                    </ul>
                </div>
                <!--{ / }-->
                <p class="hd v2">
                    <span class="info">
                        {=__('수량')} : {...goodsCnt} | {=gd_global_order_currency_display((...goodsPrice + ...optionPrice + ...optionTextPrice) * ...goodsCnt, ..exchangeRate, ..currencyPolicy)}
                    </span>
                    <!--{ ? ...userHandleSno > 0 && ...handleSno == 0 }-->
                    <!--{ ? ...userHandleFl == 'n' }-->
                    <!--{ ? ...userHandleMode == 'b' }-->
                    <strong class="icon_deli ing">{=__('반품거절')}</strong>
                    <!--{ : ...userHandleMode == 'r' }-->
                    <strong class="icon_deli ing">{=__('환불거절')}</strong>
                    <!--{ : ...userHandleMode == 'e' }-->
                    <strong class="icon_deli ing">{=__('교환거절')}</strong>
                    <!--{ / }-->
                    <!--{ : ...userHandleFl == 'y' }-->
                    <!--{ ? ...userHandleMode == 'b' }-->
                    <strong class="icon_deli ing">{=__('반품승인')}</strong>
                    <!--{ : ...userHandleMode == 'r' }-->
                    <strong class="icon_deli ing">{=__('환불승인')}</strong>
                    <!--{ : ...userHandleMode == 'e' }-->
                    <strong class="icon_deli ing">{=__('교환승인')}</strong>
                    <!--{ / }-->
                    <!--{ : }-->
                    <!--{ ? ...userHandleMode == 'b' }-->
                    <strong class="icon_deli ing">{=__('반품신청')}</strong>
                    <!--{ : ...userHandleMode == 'r' }-->
                    <strong class="icon_deli ing">{=__('환불신청')}</strong>
                    <!--{ : ...userHandleMode == 'e' }-->
                    <strong class="icon_deli ing">{=__('교환신청')}</strong>
                    <!--{ / }-->
                    <!--{ / }-->
                    <!--{ : }-->
                    <!--{ ? gd_is_plus_shop(c.PLUSSHOP_CODE_USEREXCHANGE) === false && (substr(...orderStatus, 0, 1) == 'c' || ...orderStatus == 'b4' || ...orderStatus == 'e5' || ...orderStatus == 'r3') && ...handleDetailReasonShowFl == 'y' }-->
                    <a class="icon_deli ing refund_comp" href="../mypage/layer_order_refund_reason.php?orderNo={..orderNo}&orderGoodsNo={...sno}&userHandleSno={...userHandleSno}&orderStatus={...orderStatus}" data-toggle="modal" data-target="#popup-reason" data-type="post" data-cache="false">
                    <!--{ ? ...orderStatus == 'd2' }-->
                    {...orderStatusStr}
                    <!--{ : }-->
                    {...orderStatusStr}
                    <!--{ / }-->
                    <span class="ico_blue_arrow"></span>
                    </a>
                    <!--{ : }-->
                    <!--{ ? ...orderStatus == 'd2' }-->
                    <strong class="icon_deli finish">{...orderStatusStr}</strong>
                    <!--{ : }-->
                    <strong class="icon_deli ing">{...orderStatusStr}</strong>
                    <!--{ / }-->
                    <!--{ / }-->
                    <!--{ / }-->
                </p>
                <!--{ ?  ...naverpayStatus.code == 'DelayProductOrder'}-->
                <div style="text-align:right" class="pull-right">
                    ({=...naverpayStatus.notice} , <a href="../mypage/layer_order_naverpay_reason.php?orderNo={..orderNo}&orderGoodsNo={...sno}" data-toggle="modal" data-target="#popup-reason" data-type="post" data-cache="false" ><u>지연사유</u></a>)
                </div>
                <!--{/}-->
                <ul class="btn_bx">
                    <!--{ ? gd_is_plus_shop(c.PLUSSHOP_CODE_USEREXCHANGE) === true && (...userHandleSno > 0 || (...handleSno > 0 && ...handleDetailReasonShowFl == 'y') ) }-->
                    <li>
                        <a href="../mypage/layer_order_refund_reason.php?orderNo={..orderNo}&orderGoodsNo={...sno}&userHandleSno={...userHandleSno}&orderStatus={...orderStatus}" data-toggle="modal" data-target="#popup-reason" data-type="post" data-cache="false" class="btn btn_w">
                            <em>
                                <!--{ ? ...userHandleMode == 'b' || ...handleMode == 'b' }-->
                                {=__('반품사유')}
                                <!--{ : ...userHandleMode == 'r' || ...handleMode == 'r' }-->
                                {=__('환불사유')}
                                <!--{ : ...userHandleMode == 'e' || ...handleMode == 'e' }-->
                                {=__('교환사유')}
                                <!--{ : ...userHandleMode == 'c' || ...handleMode == 'c'}-->
                                {=__('취소사유')}
                                <!--{ / }-->
                            </em>
                        </a>
                    </li>
                    <!--{ : }-->
                    <!--{ ? substr(...orderStatus, 0, 1) == 'd' }-->
                    <li>
                        <a href="#" class="btn btn_y btn-order-settle" order-no="{..orderNo}" order-goodsno="{...sno}">{=__('구매확정')}</a>
                    </li>
                    <!--{ / }-->
                    <!--{ / }-->
                    <!--{ ? (substr(...orderStatus, 0, 1) == 'd' || substr(...orderStatus, 0, 1) == 's' || substr(...orderStatus, 0, 1) == 'z') && ...invoiceNo }-->
                    <!--{ ? ...deliveryMethodFl == 'delivery' || ...deliveryMethodFl == 'packet' || !...deliveryMethodFl }-->
                    <!--{ ? ...deliveryMethodFl != 'delivery' }-->
                    <li>
                        <a class="btn btn_w">{...deliveryMethodFlText}</a>
                    </li>
                    <!--{ / }-->
                    <li><a href="../share/delivery_trace.php?invoiceCompanySno={...invoiceCompanySno}&invoiceNo={...invoiceNo}" class="btn btn_w" target="_blank">{=__('배송추적')}</a></li>
                    <!--{ : }-->
                    <li>
                        <a href="../mypage/layer_order_delivery_method.php?orderNo={..orderNo}&orderGoodsNo={...sno}" data-toggle="modal" data-target="#popup-delivery-method" data-type="post" data-cache="false" class="btn btn_w">{...deliveryMethodFlText}</a>
                    </li>
                    <!--{ / }-->
                    <!--{ : }-->
                    <li>
                        <a class="btn btn_w">{...deliveryMethodFlText}</a>
                    </li>
                    <!--{ / }-->
                    <!--{ ? ...orderStatus == 'd1' }-->
                    <li><a href="#" class="btn btn_y btn-order-delivery" order-no="{..orderNo}" order-goodsno="{...sno}">{=__('수취확인')}</a></li>
                    <!--{ / }-->
                    <!--{ ? ...viewWriteGoodsReview }-->
                    <li><a href="../board/write.php?bdId={goodsReviewId}&gboard=r&orderGoodsNo={...sno}&goodsNo={...goodsNo}<!--{ ? guest == 'y' }-->&guest=y<!--{ / }-->" class="btn btn_y ogl-reviewrite btn-open-layer" data-toggle="modal" data-cache="false" data-target="#popup-board" >{=__('리뷰쓰기')}</a></li>
                    <!--{ / }-->

                    <!--{ ? ...viewWritePlusReview }-->
                    <li><a href="javascript:gd_popup_plus_review_write('{=..orderNo}',{=...sno},'{=...goodsNo}')" class="btn btn_y ogl-reviewrite">{=__('리뷰등록')}</a></li>
                    <!--{/}-->
                </ul>

            </div>
            <!--{ ? (mode === 'backRegist' && ...canBack == true) || (mode === 'refundRegist' && ...canRefund == true) || (mode === 'exchangeRegist' && ...canExchange == true) }-->
            <!--{ ? ...userHandleSno == 0 && ...handleSno <= 0 }-->
            <!--{ ? ...canBack == true || ...canRefund == true || ...canExchange == true }-->
            <div class="info claim-info">
                <span class="inp_chk">
                    <input class="sp" id="goodsno_{...sno}" type=checkbox  value = "{...sno}" name="orderGoodsNo[]" data-goodsno="{...goodsNo}" data-order-status="{...orderStatus}">
                    <label for="goodsno_{...sno}">
                    <!--{ ? mode == 'backRegist' }-->
                        {=__('반품 신청')}
                    <!--{ : mode == 'refundRegist'}-->
                        {=__('환불 신청')}
                    <!--{ : mode == 'exchangeRegist'}-->
                        {=__('교환 신청')}
                    <!--{ / }-->
                    </label>
                </span>
                <span class="input_content">
                    <div class="price-info">
                        <span class="count">
                            <button type="button" class="down claim-goods-cnt" title="{=__('감소')}">{=__('감소')}</button>
                            <input type="number" style="width:44px;" class="text" title="{=__('수량')}" name="claimGoodsCnt[{...sno}]" value="{...goodsCnt}" min="1" max="{...goodsCnt}" data-mode="{mode}">
                            <button type="button" class="up claim-goods-cnt" title="{=__('증가')}">{=__('증가')}</button>
                        </span>
                    </div>
                </span>
            </div>
            <!--{ / }-->
            <!--{ / }-->
            <!--{ / }-->
        </li>
    </ul>
    <!--{ / }-->

    <!--{ / // end goods loop }-->
</div>
<!--
    { / }
{ : // else if ordersByRegisterDay }
-->

<div class="my_goods no">
    <p>{=__('최근 주문 내역이 없습니다.')}</p>
</div>
<!--
{ / // end if ordersByRegisterDay }
-->


<script type="text/javascript">
    $(function () {
        // 구매취소
        $('.btn-order-cancel').click(function (e) {
            e.preventDefault();
            if (confirm("{=__('주문취소 처리를 하시겠습니까?')}")) {
                var params = {
                    mode: 'cancelRegist',
                    orderNo: $(this).attr('order-no')
                };

                $.post('../mypage/order_ps.php', params, function (data) {
                    alert(data.message);
                    if (data.code == 200) {
                        location.reload(true);
                    }
                });
            }
        });

        // 수취확인
        $('.btn-order-delivery').click(function (e) {
            e.preventDefault();
            if (confirm("{=__('수취확인 처리를 하시겠습니까?')}")) {
                var params = {
                    mode: 'deliveryCompleteRegist',
                    orderNo: $(this).attr('order-no'),
                    orderGoodsNo: $(this).attr('order-goodsno')
                };

                $.post('../mypage/order_ps.php', params, function (data) {
                    alert(data.message);
                    if (data.code == 200) {
                        location.reload(true);
                    }
                });
            }
        });

        // 구매확정
        $('.btn-order-settle').click(function (e) {
            e.preventDefault();
            if (confirm("{=__('구매확정 처리를 하시겠습니까?')}")) {
                var params = {
                    mode: 'settleRegist',
                    orderNo: $(this).attr('order-no'),
                    orderGoodsNo: $(this).attr('order-goodsno')
                };
                $.post('../mypage/order_ps.php', params, function (data) {
                    alert(data.message);
                    if (data.code == 200) {
                        location.reload(true);
                    }
                });
            }
        });

        // 클레임신청 수량 증감
        $('.claim-goods-cnt').on('click', function() {
            var selectEl = $(this).closest('.count').children('input[name*="claimGoodsCnt"]');
            var claimGoodsCnt = parseInt(selectEl.val());
            if ($(this).hasClass('up') && selectEl.attr('max') > claimGoodsCnt) {
                selectEl.val(claimGoodsCnt + 1);
            } else if ($(this).hasClass('down') && selectEl.attr('min') < claimGoodsCnt) {
                selectEl.val(claimGoodsCnt - 1);
            }
        });

        // 클래임신청 수량 초과 체크
        $('input[name*="claimGoodsCnt"]').on('keyup', function(){
            var mode = $(this).data('mode');
            var orginCnt = parseInt($(this).attr('max'));
            var claimCnt = parseInt($(this).val());
            switch (mode) {
                case 'refundRegist' :
                    mode = "{=__('환불')}";
                    break;
                case 'backRegist' :
                    mode = "{=__('반품')}";
                    break;
                case 'exchangeRegist' :
                    mode = "{=__('교환')}";
                    break;
            }
            if (claimCnt > orginCnt || claimCnt <= 0) {
                alert(__('%s수량은 주문수량 %s 보다 큰값 또는 0 값을 입력할 수 없습니다.', [mode, orginCnt]));
                $(this).val(orginCnt);
            }
        });
    });
</script>
<script type="text/javascript" src="\{=c.PATH_SKIN}js/gd_board_goods.js" charset="utf-8"></script>

