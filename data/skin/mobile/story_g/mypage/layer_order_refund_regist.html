{*** 환불신청 | mypage/layer_order_refund_regist.php ***}

<div class="ly_head">
    <h1 class="h_tit elp">{=__('환불신청')}</span></h1>
</div>
<!--{ ? gd_is_plus_shop(c.PLUSSHOP_CODE_USEREXCHANGE) === true }-->
<form name="frmRefundRegist" id="frmRefundRegist" method="post" action="../mypage/order_ps.php">
<input type="hidden" name="mode" value="{mode}" />
<input type="hidden" name="orderNo" value="{orderNo}" />
<input type="hidden" name="orderGoodsNo" value="{orderGoodsNo}" />
<input type="hidden" name="orderStatus" value="{orderStatus}" />
<input type="hidden" name="returnUrl" value="{returnUrl}">
<h2 class="my_tit">{=__('주문목록')}</h2>
<div id="mypage-orderlist">
    <!-- 주문상품 리스트 -->
    {=includeFile('mypage/_order_goods_list.html')}
    <!--// 주문상품 리스트 -->
</div>
<h2 class="my_tit">{=__('환불사유')}</h2>
<div class="all-borN">
    <div class="input_wrap ty2">
        <div class="input_title">{=__('사유')}</div>
        <div class="input_content">
            <div class="select-small-outer inp_sel">
                {=gd_select_box(null, 'userHandleReason', userHandleReason, null, null, __('선택하세요'), '', 'tune')}
            </div>
        </div>
    </div>
    <div class="input_wrap ty2">
        <div class="input_title verTop">{=__('메모')}</div>
        <div class="input_content">
            <textarea title="{=__('메모입력')}" name="userHandleDetailReason" class="textarea ty2" maxlength="1000"></textarea>
        </div>
    </div>
</div>
<h2 class="my_tit">{=__('환불 정보')}</h2>
<div class="all-borN">
    <div class="input_wrap ty2">
        <div class="input_title">{=__('은행')}</div>
        <div class="input_content">
            <div class="select-small-outer inp_sel">
                {=gd_select_box(null, 'userRefundBankName', userRefundBankName, null, null, __('선택하세요'), '', 'tune')}
            </div>
        </div>
    </div>
    <div class="input_wrap ty2">
        <div class="input_title">{=__('계좌번호')}</div>
        <div class="input_content">
            <input type="number" name="userRefundAccountNumber" class="input-text wp100" maxlength="20" placeholder="{=__('-를 제외한 숫자')}">
        </div>
    </div>
    <div class="input_wrap ty2">
        <div class="input_title">{=__('예금주')}</div>
        <div class="input_content">
            <input type="text" name="userRefundDepositor" class="input-text wp100" maxlength="20">
        </div>
    </div>
</div>
<div class="caution"><p class="caution-msg2">{=__('결제하신 수단에 따라 환불 방법에 차이가 있을 수 있습니다.')}</p></div>
<div>
    <ul class="btn_bx">
        <li>
            <button type="button" class="btn btn_g layerboard-close ly_btn_close"><em>{=__('취소')}</em></button>
        </li>
        <li>
            <button type="submit" class="btn layerboard-save"><em>{=__('확인')}</em></button>
        </li>
    </ul>
</div>
</form>
<button type="button" class="bn_cls v2 ly_btn_close"><span class="sp">{=__('닫기')}</span></button>

<script type="text/javascript" src="../js/jquery/jquery.serialize.object.js"></script>
<script type="text/javascript">
    var orderRefundSuubmitFl = true;
    $(function(){
        $('#frmRefundRegist').validate({
            submitHandler: function (form) {
                if (orderRefundSuubmitFl === false) {
                    alert(__('처리중입니다. 잠시만 기다려주세요.'));
                    return false;
                }

                if (!$('input[name*="orderGoodsNo"]:checkbox:checked').length) {
                    alert("{=__('처리 할 상품을 선택하세요.')}");
                    return false;
                }

                form.target = 'ifrmProcess';
                form.submit();
                orderRefundSuubmitFl = false;
            },
            rules: {
                userHandleReason: {
                    required:true
                },
                userRefundAccountNumber: {
                    number: true
                },
            },
            messages: {
                userHandleReason: {
                    required:"{=__('환불사유를 선택해주세요.')}"
                },
                userRefundAccountNumber: {
                    number: "{=__('숫자만 입력하실 수 있습니다.')}"
                },
            }
        });

        // 신청수량 검증
        $('#frmRefundRegist input[name*=claimGoodsCnt]').each(function() {
            $(this).rules('add', {
                required: true,
                min : 1,
                messages: {
                    required: "{=__('수량을 입력해주세요.')}",
                    min: "{=__('수량은 1개 이상 입력해주세요.')}",
                }
            });
        });

        // 전체선택 처리
        $('.all-check-goods').on('click', function(e) {
            e.preventDefault();
            if ($(this).val() == 'n') {
                $('input[name="orderGoodsNo[]"]').prop('checked', true);
                $(this).text("{=__('선택해제')}");
                $(this).val('y');
            } else {
                $('input[name="orderGoodsNo[]"]').prop('checked', false);
                $(this).text("{=__('전체선택')}");
                $(this).val('n');
            }
            $(this).blur();
        });

        // 전체 선택으로 초기화
        if ($('.all-check-goods').length) {
            $('.all-check-goods').trigger('click');
        }

        // 체크박스 상태에 따른 전체선택버튼 변경처리
        $('input:checkbox[name="orderGoodsNo[]"]').click(function () {
            var checkedCount = 0;
            var eachCheckBox = $(this).closest('#mypage-orderlist').find('input[name="orderGoodsNo[]"]:checkbox');
            eachCheckBox.each(function () {
                if ($(this).prop('checked') === true) {
                    checkedCount++;
                }
            });
            if (eachCheckBox.length == checkedCount) {
                $('.all-check-goods').text("{=__('선택해제')}");
                $('.all-check-goods').val('y');
            } else {
                $('.all-check-goods').text("{=__('전체선택')}");
                $('.all-check-goods').val('n');
            }
        });
    });
</script>
<!--{ / }-->
