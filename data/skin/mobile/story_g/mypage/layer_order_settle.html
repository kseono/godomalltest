{*** 구매확정 | mypage/layer_order_settle.php ***}
<div class="ly_head">
    <h1 class="h_tit elp">{=__('구매확정')}</span></h1>
</div>
<form name="frmSettleRegist" id="frmSettleRegist" method="post" action="../mypage/order_ps.php">
    <input type="hidden" name="orderNo" value="{orderNo}">
    <input type="hidden" name="mode" value="settleRegistAll">
    <input type="hidden" name="returnUrl" value="{returnUrl}">
    <h2 class="my_tit">{=__('주문목록')}</h2>
    <h2 class="my_tit">{=__('주문번호')}<a href="../mypage/order_view.php?orderNo={orderNo}">{orderNo}</a>
        <div class="hd sub check-claim-btn">
            <button class="write-btn all-check-goods" value="n">{=__('전체선택')}</button>
        </div>
    </h2>
    <!--{ ? orderData }-->
    <!--{ @ orderData }-->
    <!--{ @ .goods }-->
    <ul class="my_goods">
        <li>
            <div class="info">
                <a href="../goods/goods_view.php?goodsNo={..goodsNo}">
                    <div class="item-check">
                        <span class="inp_chk">
                            <input class="sp" id="goodsno_{..sno}" type=checkbox  value = "{..sno}" name="orderGoodsNo[]" data-goodsno="{..goodsNo}" data-order-status="{..orderStatus}">
                            <label for="goodsno_{..sno}"></label>
                        </span>
                    </div>
                    <div class="itemhead">
                        <div class="thmb img">{..goodsImage}</div>
                    </div>
                    <div class="itembody">
                        <span class="elp2">{..goodsNm}</span>
                        <!--{ ? ..optionInfo }-->
                        <!--{ @ ..optionInfo }-->
                        <dd class="goods-option">{...value_.optionName} : {...value_.optionValue}
                            <!--{ ? ...value_.optionRealPrice != 0}-->
                            (<!--{ ? ...value_.optionRealPrice > 0 }-->+<!--{ / }-->{=gd_global_order_currency_display(...value_.optionRealPrice)})
                            <!--{ / }-->
                            <!--{ ? ...index_ == ...size_ - 1 }-->
                            <!--{ ? empty(...value_.deliveryInfoStr) === false }--> [{...value_.deliveryInfoStr}]<!--{ / }-->
                            <!--{ / }-->
                        </dd>
                        <!--{ / }-->
                        <!--{ / }-->
                        <!--{ ? ..optionTextInfo }-->
                        <!--{ @ ..optionTextInfo }-->
                        <dd class="goods-option">{...value_.optionName} : {...value_.optionValue}
                            <!--{ ? ...value_.optionTextPrice != 0 && optionPriceFl == 'y' }-->
                            (<!--{ ? ...value_.optionTextPrice > 0 }-->+<!--{ / }-->{=gd_global_order_currency_display(...value_.optionTextPrice)})
                            <!--{ / }-->
                        </dd>
                        <!--{ / }-->
                        <!--{ / }-->
                    </div>
                </a>
                <!--{ ? empty(..addGoods) === false }-->
                <div class="add-goods-box">
                    <em class="add-title">{=__('추가상품')}</em>
                    <ul class="add-goods-list">
                        <!--{ @ ..addGoods }-->
                        <li>
                            <div class="add-goods-img">{...goodsImage}</div>
                            <div class="add-goods-content">
                                <span class="title">{...goodsNm}</span>
                                <div class="add-goods-text">
                                    <span class="goods-number">{=__('주문수량')} : <em>{...goodsCnt}</em></span>
                                    <span class="goods-price"><em>{=gd_global_order_currency_display(..goodsPrice, ..exchangeRate, ..currencyPolicy)}</em></span>
                                </div>
                            </div>
                        </li>
                        <!--{ / }-->
                    </ul>
                </div>
                <!--{ / }-->
                <p class="hd v2">
                    <span class="info">
                        {=__('수량')} : {..goodsCnt} | {=gd_global_order_currency_display((..goodsPrice + ..optionPrice + ..optionTextPrice) * ..goodsCnt, ..exchangeRate, ..currencyPolicy)}
                    </span>
                    <!--{ ? ..orderStatus == 'd2' }-->
                    <strong class="icon_deli finish">{..orderStatusStr}</strong>
                    <!--{ : }-->
                    <strong class="icon_deli ing">{..orderStatusStr}</strong>
                    <!--{ / }-->
                </p>
        </li>
    </ul>
    <!--{ / }-->
    <!--{ / }-->
    <!--{ : }-->
    <div class="my_goods no">
        <p>{=__('최근 주문 내역이 없습니다.')}</p>
    </div>
    <!--{ / }-->
    <div>
        <ul class="btn_bx">
            <li>
                <button type="button" class="btn btn_g layerboard-close ly_btn_close"><em>{=__('취소')}</em></button>
            </li>
            <li>
                <button type="submit" class="btn layerboard-save"><em>{=__('확인')}</em></button>
            </li>
        </ul>
    </div>
</form>
<button type="button" class="bn_cls v2 ly_btn_close"><span class="sp">{=__('닫기')}</span></button>
<script type="text/javascript" src="../js/jquery/jquery.serialize.object.js"></script>
<script type="text/javascript">
    $(function(){
        $('#frmSettleRegist').validate({
            submitHandler: function (form) {
                if (!$('input[name*="orderGoodsNo"]:checkbox:checked').length) {
                    alert("{=__('구매확정 할 상품을 선택하세요.')}");
                    return false;
                }

                if (confirm("{=__('구매확정 처리를 하시겠습니까?')}")) {
                    form.target = 'ifrmProcess';
                    form.submit();
                }
            }
        });

        // 전체선택 처리
        $('.all-check-goods').on('click', function(e) {
            e.preventDefault();
            if ($(this).val() == 'n') {
                $('input[name="orderGoodsNo[]"]').prop('checked', true);
                $(this).text("{=__('선택해제')}");
                $(this).val('y');
            } else {
                $('input[name="orderGoodsNo[]"]').prop('checked', false);
                $(this).text("{=__('전체선택')}");
                $(this).val('n');
            }
            $(this).blur();
        });

        // 체크박스 상태에 따른 전체선택버튼 변경처리
        $('input:checkbox[name="orderGoodsNo[]"]').click(function () {
            var checkedCount = 0;
            var eachCheckBox = $(this).closest('#frmSettleRegist').find('input[name="orderGoodsNo[]"]:checkbox');
            eachCheckBox.each(function () {
                if ($(this).prop('checked') === true) {
                    checkedCount++;
                }
            });
            if (eachCheckBox.length == checkedCount) {
                $('.all-check-goods').text("{=__('선택해제')}");
                $('.all-check-goods').val('y');
            } else {
                $('.all-check-goods').text("{=__('전체선택')}");
                $('.all-check-goods').val('n');
            }
        });
    });
</script>
