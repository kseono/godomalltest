{*** 예치금 | mypage/deposit.php ***}
{ # header }
<p class="my_money">
    <span class="tit">{=__('사용 가능한')} {=gd_display_deposit('name')}</span>
    <strong>{=gd_money_format(gMemberInfo.deposit)}{=gd_display_deposit('unit')}</strong>
</p>

<div class="my_tit">
    <h2 class="my_tit">{=gd_display_deposit('name')} {=__('내역')}</h2>
    <form method="get" name="frmDateSearch" id="frmDateSearch" autocomplete="off">
        <input type="hidden" name="mode" value="{mode}">
        <fieldset>
            <legend>{=gd_display_deposit('name')} {=__('내역')}</legend>
            <div>
                <span class="select-cal">
                    <div class="select-small-outer inp_sel">
                        {=gd_select_box(null, 'searchPeriod', searchDate, null, selectDate, null, null, 'check-option-inner')}
                    </div>
                </span>
            </div>
        </fieldset>
    </form>
</div>
<!--{ ? list }-->
<div class="money_history">
    <div class="tbl2">
        <table>
            <caption><span>{=gd_display_deposit('name')} {=__('내역 표')}</span></caption>
            <colgroup>
                <col style="width:105px">
                <col>
                <col style="width:110px">
            </colgroup>
            <thead>
            <tr>
                <th scope="col">{=__('일자')}</th>
                <th scope="col">{=__('내용')}</th>
                <th scope="col">{=gd_display_deposit('name')}</th>
            </tr>
            </thead>
            <tbody>
            <!--{ @ list }-->
            <tr data-order-no="{.handleCd}" data-order-handlesno="{.handleSno}">
                <td>{.regdate}</td>
                <td class="contx">
                    {.contents} <br />
                    {? .handleDetailReasonShowFl =='y' && .handleReason !=''}
                    <a href="#lyReason" class="c_blue btn_open_layer">[{.handleReason}]</a>
                    {: .handleReason !=''}
                    [{.handleReason}]
                    {/}
                </td>
                <td class="<!--{ ? .deposit < 0 }-->minus<!--{ / }-->"><!--{ ? .deposit > 0 }-->+<!--{ / }-->{=gd_money_format(.deposit)}{=gd_display_deposit('unit')}</td>
            </tr>
            <!--{ / }-->
            </tbody>
        </table>
    </div>
    <button type="button" class="btn btn_tbl" data-page="2">{=__('내역 더보기')}</button>
</div>
<!--{ : }-->
<div class="money_history no">
    <p>
        <!--{ ? !gGlobal.isFront }-->
        {=__('%s 내역이 없습니다.', gd_display_deposit('name'))}
        <!--{ : }-->
        {=__('조회내역이 없습니다.')}
        <!--{ / }-->
    </p>
</div>
<!--{ / }-->
<div id="lyReason" class="layer_wrap dn" data-remote="../mypage/layer_deposit_reason.php"></div>
<script type="text/javascript">
    <!--
    $(document).ready(function(){
        $('.btn.btn_tbl').on('click', function(){
            get_list($(this).data('page'));
        });

        // 검색기간 선택
        if ($('.check-option-inner').length) {
            $('.check-option-inner').change(function (e) {
                $('#frmDateSearch').submit();
            });
        }
    });

    function get_list(page) {
        var searchPeriod = parseInt($('.check-option-inner').val());
        $.get('./deposit.php', {'page' : page, 'searchPeriod' : searchPeriod}, function (data) {
            var addDepositList = $(data).find('.tbl2 tbody tr');

            if (addDepositList.length) {
                $('.tbl2 tbody').append(addDepositList);

                $('.btn.btn_tbl').data('page', page + 1);
            } else {
                alert("{=__('더이상 %s 내역이 없습니다.', gd_display_deposit('name'))}");
            }
        });
    }

    $(document).on("click",".btn_open_layer",function(){

        var obj = $(this);
        var target = obj.attr('href');
        var url = $(target).data('remote');
        var params = {
            orderNo: obj.closest('tr').data('order-no'),
            handleSno: obj.closest('tr').data('order-handlesno')
        };
        $.post(url, params, function (data) {
            if (!_.isUndefined(data.code) && data.code == 0) {
                alert(data.message);
                return false;
            }
            $(target).removeClass('dn').empty().html(data);

        });

    });
    //-->
</script>
{ # footer}