{*** 배송지 관리 | mypage/shipping.php ***}
{ # header }
<div class="contents-inner mypage shipping">
    <div class="shipping-add-layer"><span class="btn-shipping red"><a href="../mypage/layer_shipping_address_regist.php" data-toggle="modal" data-target="#popup-shipping" data-type="post" data-cache="false"><em>{=__('배송지 추가')}</em></a></span></div>

    <!--{ ? shippingList }-->
    <!--{ @ shippingList }-->
    <div class="shipping-info">
        <div class="shipping-title">{.shippingTitle}<!--{ ? .defaultFl == 'y' }--> <span>({=__('기본배송지')})</span><br /><!--{ / }--></div>
        <div class="shipping-address">
            <!--{ ? gGlobal.isFront }-->
            <span>({.shippingZonecode})</span>
            <p>{.shippingAddressSub}, {.shippingAddress}, {.shippingState}, {.shippingCity}, {.shippingCountry}</p>
            <!--{ : }-->
            <span>({.shippingZonecode})</span>
            <p>{.shippingAddress} {.shippingAddressSub}</p>
            <!--{ / }-->
        </div>
        <div class="shipping-data">
            <table>
                <tr>
                    <td>{=__('받으실 분')}</td>
                    <td>{.shippingName}</td>
                </tr>
                <tr>
                    <td>{=__('전화번호')}</td>
                    <td><!--{ ? gGlobal.isFront }-->(+{.shippingPhonePrefix}) <!--{ / }-->{.shippingPhone}</td>
                </tr>
                <tr>
                    <td>{=__('휴대폰')}</td>
                    <td><!--{ ? gGlobal.isFront }-->(+{.shippingCellPhonePrefix}) <!--{ / }-->{.shippingCellPhone}</td>
                </tr>
            </table>
            <div class="shipping-btn-info">
                <!--{ ? .defaultFl != 'y' }--><span class="btn-shipping btn-shipping-default" data-sno="{=.sno}">{=__('기본 배송지로 설정')}</span><!--{ / }-->
                <span class="btn-shipping"><a href="../mypage/layer_shipping_address_regist.php?sno={=.sno}" data-toggle="modal" data-target="#popup-shipping" data-type="post" data-cache="false">{=__('수정')}</a></span>
                <span class="btn-shipping js-delete" data-sno="{=.sno}" data-default-fl="{=.defaultFl}">{=__('삭제')}</span>
            </div>
        </div>
    </div>
    <!--{ / }-->
    <!--{ : }-->
    <div class="no-shipping">{=__('배송지 목록이 없습니다.')}</div>
    <!--{ / }-->
</div>

<!-- 새 배송지 추가 레이어 -->
<div id="deliveryAddLayer" class="layer-wrap dn"></div>
<!--//새 배송지 추가 레이어 -->

<script type="text/javascript">
    // DOM 로드
    $(function(){
        // 등록/수정 레이어 바인딩
        $('.shipping-add-layer .btn-open-layer, .delivery-layer .btn-open-layer').bind('click', function(e){
            var target = $(this).attr('href');
            if (target == '#deliveryAddLayer') {
                // 배송지 등록/수정 모드에 따른 파라미터 설정
                var param = !_.isUndefined($(this).data('sno')) && $(this).data('sno') > 0 ? '?sno=' + $(this).data('sno') : '';

                // AJAX 호출
                $(target).empty();
                $.get('../order/layer_shipping_address_regist.php' + param, function(data){
                    $(target).append(data);
                    $(target).find('>div').center();
                });
            }
        });

        // 배송지 클릭
        $('.shipping-address').click(function(e){
            insertShippingAddress($(this).closest('tr'));
            $('.delivery-layer .close').trigger('click');
            return false;
        });

        // 삭제하기
        $('.js-delete').click(function(e){
            if ($(this).data('default-fl') == 'y') {
                alert(__('기본 배송지는 삭제할 수 없습니다. 변경 후 삭제해주세요.'));
            } else {
                if (confirm(__('나의 배송지 [%s]을(를) 정말로 삭제하시겠습니까?', $(this).closest('.shipping-info').find('.shipping-title').text()))) {
                    var params = {
                        sno: $(this).data('sno'),
                        mode: 'shipping_delete'
                    };
                    $.post('../order/layer_shipping_ps.php', params, function(data){
                        if(data.code == 200) {
                            location.reload();
                        }
                    });
                    return false;
                }
            }
        });

        $('.btn-shipping-default').click(function(){
            var params = {
                sno: $(this).data('sno'),
                mode: 'shipping_default'
            };
            $.post('../order/layer_shipping_ps.php', params, function(data){
                alert(data.message);
                if(data.code == 200) {
                    location.reload();
                }
            });

        });
    });

    // 배송지관리 이벤트
    function goPageOnDeliveryAddress(page) {
        top.location.reload(true);
//        $.get('../order/layer_shipping_address.php?' + page, function(data){
//            $('#myShippingListLayer').empty().append(data);
//            $('#myShippingListLayer').find('>div').center();
//        });
    }

    // 배송지 클릭
    function insertShippingAddress(obj)
    {
        var params = {
            shippingName: obj.find('input[name=shippingName]:eq(0)').val(),
            shippingZonecode: obj.find('input[name=shippingZonecode]:eq(0)').val(),
            shippingZipcode: obj.find('input[name=shippingZipcode]:eq(0)').val(),
            shippingAddress: obj.find('input[name=shippingAddress]:eq(0)').val(),
            shippingAddressSub: obj.find('input[name=shippingAddressSub]:eq(0)').val(),
            shippingPhone: obj.find('input[name=shippingPhone]:eq(0)').val(),
            shippingCellPhone: obj.find('input[name=shippingCellPhone]:eq(0)').val(),
        };
    }
</script>

{ # footer }
