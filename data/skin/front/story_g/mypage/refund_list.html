{*** 마이페이지 > 취소/반품/교환 내역 | mypage/cancel_list.php ***} { # header }

<div class="contents">
    <div class="contents-inner mypage">

        <!-- 마이페이지 회원 요약정보 -->
        {=includeWidget('mypage/_member_summary.html')}
        <!-- 마이페이지 회원 요약정보 -->

        <div class="section">
            <div class="section-header">
                <h2 class="h2">{=__('환불/입금 내역')}</h2>
            </div>
            <div class="section-body">
                <form method="get" name="frmDateSearch">
                    <input type="hidden" name="mode" value="{mode}">
                    <fieldset>
                        <legend>{=__('주문목록/배송조회 날짜 검색')}</legend>

                        <div class="date-check">
                            <h3 class="h3">
                                {=__('조회기간')}
                            </h3>
                            <div class="check-option clear">
                                <div class="check-option-inner" data-target-name="wDate[]">
                                    <div class="btn"><button class="inner" type="button" data-value="0">{=__('오늘')}</button></div>
                                    <div class="btn"><button class="inner" type="button" data-value="7">7{=__('일')}</button></div>
                                    <div class="btn"><button class="inner" type="button" data-value="15">15{=__('일')}</button></div>
                                    <div class="btn"><button class="inner" type="button" data-value="30">1{=__('개월')}</button></div>
                                    <div class="btn"><button class="inner" type="button" data-value="90">3{=__('개월')}</button></div>
                                    <div class="btn"><button class="inner" type="button" data-value="365">1{=__('년')}</button></div>
                                </div>
                                <div id="layer" class="layer"></div>
                            </div>
                            <div class="check-cal">
                                <div class="cal-from">
                                    <input type="text" name="wDate[]" value="{wDate[0]}" id="picker2" class="js-datepicker" />
                                    <img class="icon-cal" src="../img/etc/icon-cal.png" alt="{=__('달력 아이콘')}" />
                                </div>
                                <div class="divide">~</div>
                                <div class="cal-to">
                                    <input type="text" name="wDate[]" value="{wDate[1]}" class="js-datepicker" />
                                    <img class="icon-cal" src="../img/etc/icon-cal.png" alt="{=__('달력 아이콘')}" />
                                </div>
                            </div>
                            <div class="submit-block">
                                <button type="submit" class="skinbtn point2 cl-find"><em>{=__('조회')} <img alt="" src="../img/etc/search.png" /></em></button>
                            </div>
                        </div>
                    </fieldset>
                </form>
            </div>
        </div>
        <div class="section">
            <!--{ ? gd_is_plus_shop(c.PLUSSHOP_CODE_USEREXCHANGE) === true && userHandleFl === true }-->
            <div class="tab">
                <a href="./refund_list.php?mode=refundRequest" <!--{ ? empty(mode) === true || mode === 'refundRequest' }-->class="on"<!--{ / }-->>{=__('환불 신청 내역')}</a>
                <a href="./refund_list.php?mode=refund" <!--{ ? mode === 'refund' }-->class="on"<!--{ / }-->>{=__('환불/입금 처리 현황')} </a>
                <a class="blank"></a>
            </div>
            <!--{ / }-->
            <div class="section-header">
                <h3 class="h3">
                    <!--{ ? wData[0] && wDate[1] }-->
                    <b><span>{=gd_date_format('Y.m.d', wDate[0])}</span> ~ <span>{=gd_date_format('Y.m.d', wDate[1])}</span></b> {=__('까지의')}
                    <!--{ / }-->
                    {=__('환불/입금 내역 총')} <b class="c-red">{=number_format(total)}</b>{=__('건')}
                </h3>
            </div>
            <div class="section-body">
                <!-- 주문상품 리스트 -->
                {=includeFile('mypage/_order_goods_list.html')}
                <!--// 주문상품 리스트 -->
            </div>
        </div>
        <div>
            <div class="board-paging">
                {page->getPage()}
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    $(function(){
        // 인풋박스 선택 이벤트
        if ($('.js-datepicker').length) {
            var today = new Date();
            var minDate = new Date();
            minDate.setDate(today.getDate() - 365);
            minDate = new Date(minDate.getFullYear(), minDate.getMonth(), minDate.getDate());

            $('.js-datepicker').datetimepicker({
                locale: '{=gGlobal.locale}',
                format: 'YYYY-MM-DD',
                dayViewHeaderFormat: 'YYYY MM',
                viewMode: 'days',
                ignoreReadonly: true,
                debug: false,
                keepOpen: false,
                maxDate: today,
                minDate: minDate
            });
            $('.check-cal img').click(function(e){
                $(this).prev('.js-datepicker').data('DateTimePicker').show();
            });
        }

        // 기간버튼 선택 이벤트
        if ($('.check-option-inner').length) {
            $('.check-option-inner button.inner').click(function (e) {
                $startDate = $endDate = '';
                $period = $(this).data('value');
                $elements = $('input[name="' + $(this).closest('.check-option-inner').data('target-name') + '"]');
                $format = $($elements[0]).data('DateTimePicker').format();
                if ($period >= 0) {
                    $startDate = moment().hours(0).minutes(0).seconds(0).subtract($period, 'days').format($format);
                    $endDate = moment().hours(0).minutes(0).seconds(0).format($format);
                }
                $($elements[0]).val($startDate);
                $($elements[1]).val($endDate);

                $('.check-option-inner .btn').removeClass('active');
                $(this).parents('.btn').addClass('active');
            });

            // 선택된 버튼에 따른 값 초기화
            $elements = $('input[name*=\'' + $('.check-option-inner').data('target-name') + '\']');
            $checkDateValue = [0, 7, 15, 30, 90, 365];
            $today = moment().format('YYYY-MM-DD');
            if ($elements.length && $elements.val() != '') {
                $interval = moment($($elements[1]).val()).diff(moment($($elements[0]).val()), 'days');
                // 선택한 기간이 배열내에 있고 $elements[1]이 검색당일인 경우에만 기간선택 버튼 스타일 적용
                if (jQuery.inArray($interval, $checkDateValue) != '-1' && $($elements[1]).val() === $today) {
                    $('.check-option-inner').find('button[data-value="' + $interval + '"]').trigger('click');
                }
            } else {
                $('.check-option-inner').find('button[data-value="-1"]').trigger('click');
            }
        }

        // 조회기간 검증
        $('form[name="frmDateSearch"]').submit(function(e){
            $chekcInputDate = $('input[name="wDate[]"]');
            var startDate = $($chekcInputDate[0]).val();
            var endDate = $($chekcInputDate[1]).val();

            if (startDate > endDate) {
                alert('종료 날짜가 시작 날짜보다 빠릅니다.\n확인 후 검색기간을 다시 선택해주세요.');
                return false;
            }
        });
    });
</script>

{ # footer}
