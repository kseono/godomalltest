{*** 마이페이지 > 마일리지 | mypage/mileage.php ***}
{ # header }
<div class="contents-inner mypage">
    <!-- 마이페이지 회원 요약정보 -->{=includeWidget('mypage/_member_summary.html')}<!-- 마이페이지 회원 요약정보 -->
    <div class="section">
        <div class="section-header">
            <h2 class="h2">{=gd_display_mileage_name()}</h2>
        </div>
        <div class="section-body">
            <form name="formSearch" id="formSearch" method="get">
                <div class="date-check">
                    <h3 class="h3">
                        {=__('조회기간')}
                    </h3>

                    <div class="check-option clear">
                        <div class="check-option-inner" data-target-name="regDt[]">
                            <div class="btn">
                                <button class="inner" type="button" data-value="0">{=__('오늘')}</button>
                            </div>
                            <div class="btn">
                                <button class="inner" type="button" data-value="7">7{=__('일')}</button>
                            </div>
                            <div class="btn">
                                <button class="inner" type="button" data-value="15">15{=__('일')}</button>
                            </div>
                            <div class="btn">
                                <button class="inner" type="button" data-value="30">1{=__('개월')}</button>
                            </div>
                            <div class="btn">
                                <button class="inner" type="button" data-value="90">3{=__('개월')}</button>
                            </div>
                            <div class="btn">
                                <button class="inner" type="button" data-value="365">1{=__('년')}</button>
                            </div>
                        </div>
                    </div>
                    <div class="check-cal">
                        <div class="cal-from">
                            <input type="text" name="regDt[]" value="{ regDt[0] }" class="js-datepicker"/>
                            <img class="icon-cal" src="../img/etc/icon-cal.png" alt="{=__('달력 아이콘')}"/>
                        </div>
                        <div class="divide">~</div>
                        <div class="cal-to">
                            <input type="text" name="regDt[]" value="{ regDt[1] }" class="js-datepicker"/>
                            <img class="icon-cal" src="../img/etc/icon-cal.png" alt="{=__('달력 아이콘')}"/>
                        </div>
                    </div>
                    <div class="submit-block">
                        <button class="skinbtn point2 cl-find" type="submit"><em>{=__('조회')}
                            <img alt="" src="../img/etc/search.png"/></em>
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="section top-date">
        <div class="section-header">
            <h3 class="h3">
                {? active['regTerm']['-1'] == 'active' }<b>{=__('전체')}</b>{:}
                <b>{ regDt[0] } ~ { regDt[1] }</b> {=__('까지의')}{/} {=gd_display_mileage_name()} {=__('사용내역 총')} <b class="c-red">{page->recode['total']}</b>{=__('건')}
            </h3>
        </div>
        <div class="section-body">
            <div class="table1 type1 m2">
                <table class="board-list">
                    <colgroup>
                        <col style="width:13%"/>
                        <col/>
                        <col style="width:35%"/>
                        <col/>
                        <col style="width:124px"/>
                        <col style="width:124px"/>
                    </colgroup>
                    <thead>
                    <tr>
                        <th>{=__('날짜')}</th>
                        <th>{=__('유형')}</th>
                        <th>{=__('내용')}</th>
                        <th>{=__('유효기간')}</th>
                        <th>{=gd_display_mileage_name()} {=__('내역')}</th>
                        <th>{=__('잔여')} {=gd_display_mileage_name()}</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!--{@ list}-->
                    <tr>
                        <td class="ta-c">{.regdate}</td>
                        <td class="ta-c">{? .mileage >= 0}{=__('적립')}{:}{=__('차감')}{/}</td>
                        <td class="ta-c">{.contents}{?.handleNo=='smsFl'}<br/>Sms {=__('수신동의')}{:.handleNo=='mailingFl'}<br/>{=__('이메일 수신동의')}{/}</td>
                        <td class="ta-c">{.regdate}~{=gd_date_format('Y-m-d', .deleteScheduleDt)}</td>
                        <td class="money">
                            {? .mileage >= 0}<strong class="c-red">{=gd_mileage_display(.mileage, true, null, null, true)}</strong> {:}
                            <strong class="c-blue">{=gd_mileage_display(.mileage, true, null, null, true)}</strong> {/}
                        </td>
                        <td class="money">{=gd_mileage_display(.afterMileage)}</td>
                    </tr>
                    <!--{/}-->
                    </tbody>
                </table>
            </div>
            <div class="board-paging">
                { page->getPage() }
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    <!--
    $(document).ready(function () {
        $('#formSearch').validate({
            submitHandler: function (form) {
                $('<input />').attr({
                    "type": "hidden", "name": "regTerm", "value": $('div.active').find('button').data('value')
                }).appendTo(form);

                //조회기간 검증
                $chekcInputDate = $('input[name="regDt[]"]');
                var startDate = $($chekcInputDate[0]).val();
                var endDate = $($chekcInputDate[1]).val();

                if (startDate > endDate) {
                    alert('종료 날짜가 시작 날짜보다 빠릅니다.\n확인 후 검색기간을 다시 선택해주세요.');
                    return false;
                }

                form.submit();
            }
        });
        if ($('.js-datepicker').length) {
            $('.js-datepicker').datetimepicker({
                locale: '{=gGlobal.locale}',
                format: 'YYYY-MM-DD',
                dayViewHeaderFormat: 'YYYY MM',
                viewMode: 'days',
                ignoreReadonly: true
            });
            $('.check-cal img').click(function (e) {
                $(this).prev('.js-datepicker').data('DateTimePicker').show();
            });
            //날짜 체크 정규식 /^(19|20)\d{2}-(0[1-9]|1[012])-(0[1-9]|[12][0-9]|3[0-1])$/;
        }
        if ($('.check-option-inner').length) {
            $('.check-option-inner button.inner').click(function (e) {
                $startDate = $endDate = '';
                $period = $(this).data('value');
                $elements = $('input[name="' + $(this).closest('.check-option-inner').data('target-name') + '"]');
                $format = $($elements[0]).data('DateTimePicker').format();
                if ($period >= 0) {
                    $startDate = moment().hours(0).minutes(0).seconds(0).subtract($period, 'days').format($format);
                    $endDate = moment().hours(0).minutes(0).seconds(0).format($format);
                }
                $($elements[0]).val($startDate);
                $($elements[1]).val($endDate);

                $('.check-option-inner .btn').removeClass('active');
                $(this).parents('.btn').addClass('active');
            });
            // 선택된 버튼에 따른 값 초기화
            $elements = $('input[name*=\'' + $('.check-option-inner').data('target-name') + '\']');
            $checkDateValue = [0, 7, 15, 30, 90, 365];
            $today = moment().format('YYYY-MM-DD');
            if ($elements.length && $elements.val() != '') {
                $interval = moment($($elements[1]).val()).diff(moment($($elements[0]).val()), 'days');
                // 선택한 기간이 배열내에 있고 $elements[1]이 검색당일인 경우에만 기간선택 버튼 스타일 적용
                if (jQuery.inArray($interval, $checkDateValue) != '-1' && $($elements[1]).val() === $today) {
                    $('.check-option-inner').find('button[data-value="' + $interval + '"]').trigger('click');
                }
            } else {
                $('.check-option-inner').find('button[data-value="-1"]').trigger('click');
            }
        }
    });
    //-->
</script>
{ # footer }
