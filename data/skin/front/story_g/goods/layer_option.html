{*** 옵션변경 레이어 | goods/layer_option.php ***}
<style>
    .chosen-container .chosen-results {
        max-height:100px;
    }
</style>
<script type="text/javascript" src="../js/gd_goods_view.js"></script>
<script type="text/javascript">
    var goodsViewLayerController = new gd_goods_view();
    $(document).on('keydown focusout', 'input[name^=goodsCnt]', function(e){
        $(this).val($(this).val().replace(/[^0-9\-]/g,""));
    });
</script>
<!-- 옵션변경 레이어 -->
<div class="box option-layer" >
    <form name=frmViewLayer id='frmViewLayer' method=post>
        <input type="hidden" name="scmNo" value="{=goodsView['scmNo']}" />
        <input type="hidden" name="cartMode" value="" />
        <input type="hidden" name="set_goods_price"  id="set_goods_price" value="{=gd_global_money_format(gd_isset(goodsView['goodsPrice'],0),false)}" />
        <input type="hidden" name="set_goods_fixedPrice"  id="set_goods_fixedPrice" value="{=gd_isset(goodsView['fixedPrice'],0)}" />
        <input type="hidden" name="set_goods_mileage" value="{=gd_isset(goodsView['goodsMileageBasic'],0)}" />
        <input type="hidden" name="set_goods_stock" value="{=gd_isset(goodsView['stockCnt'],0)}" />
        <input type="hidden" name="set_coupon_dc_price" value="{=gd_isset(goodsView['goodsPrice'],0)}" />

        <input type="hidden" name="set_goods_total_price" id="set_goods_total_price" value="0" />
        <input type="hidden" name="set_option_price"  id="set_option_price" value="0" />
        <input type="hidden" name="set_option_text_price" id="set_option_text_price" value="0" />
        <input type="hidden" name="set_add_goods_price"  id="set_add_goods_price" value="0" />
        <input type="hidden" name="set_total_price" id="set_total_price" value="0" />


        <input type="hidden" name="mileageFl" value="{=goodsView['mileageFl']}" />
        <input type="hidden" name="mileageGoods" value="{=goodsView['mileageGoods']}" />
        <input type="hidden" name="mileageGoodsUnit" value="{=goodsView['mileageGoodsUnit']}" />
        <input type="hidden" name="goodsDiscountFl" value="{=goodsView['goodsDiscountFl']}" />
        <input type="hidden" name="goodsDiscount" value="{=goodsView['goodsDiscount']}" />
        <input type="hidden" name="goodsDiscountUnit" value="{=goodsView['goodsDiscountUnit']}" />

        <input type="hidden" name="taxFreeFl" value="{=goodsView['taxFreeFl']}" />
        <input type="hidden" name="taxPercent" value="{=goodsView['taxPercent']}" />

        <input type="hidden" name="scmNo" value="{=goodsView['scmNo']}" />
        <input type="hidden" name="brandCd" value="{=goodsView['brandCd']}" />
        <input type="hidden" name="cateCd" value="{=goodsView['cateCd']}" />
        <input type="hidden" name="orderPossible" value="{=goodsView['orderPossible']}" />
        <input type="hidden" name="selectGoodsFl" value="{=selectGoodsFl}" />

        <input type="hidden" id="set_dc_price" value="0" />

        <input type="hidden" id="goodsOptionCnt" value="1" />
        <input type="hidden" name="useBundleGoods" value="1" />
        <input type="hidden" name="goodsDeliveryFl" value="{=goodsView['delivery']['basic']['goodsDeliveryFl']}" />
        <input type="hidden" name="sameGoodsDeliveryFl" value="{=goodsView['delivery']['basic']['sameGoodsDeliveryFl']}" />
        <input type="hidden" name="mainSno" value="{=mainSno}" />
        <div class="view">
            <h2>{=__('옵션선택')}</h2>
            <div class="scroll-box">
                <div class="goods-layout1">
                    <div class="img-section">
                        {=goodsView['image']['detail']['thumb'][0]}
                    </div>
                    <div class="content-section">
                        <div class="goods-name" style="width:450px;">
                            <h3 class="goods-name-t">
                                {=gd_isset(goodsView['goodsNmDetail'])}
                                <!--{ ? gd_isset(goodsView['shortDescription']) }-->
                                <p>{=goodsView['shortDescription']}</p>
                                <!--{ / }-->

                            </h3>

                        </div>
                        <!--{ @ displayField }-->
                        <!--{ ? .value_ :'delivery'}-->
                        <div class="ag-choice choice">
                            <div class="list">
                            <strong>{=__('배송비')}</strong>
                                <div style="position:relative;">
                                    <!--{ ? goodsView['multipleDeliveryFl'] === true }-->
                                <!--{ ? gd_isset(goodsView['delivery']['basic']['fixFl']) == 'fixed'  }-->
                                <span>{=gd_global_currency_symbol()}{=gd_global_money_format(goodsView['delivery']['firstCharge']['0']['price'])}{=gd_global_currency_string()}</span>
                                <!--{ ? addGlobalCurrency }-->
                                <span>{=gd_global_add_currency_display(goodsView['delivery']['firstCharge']['0']['price'])}</span>
                                <!--{ / }-->
                                <!--{ : }-->
                                <span>{=gd_global_currency_symbol()}{=gd_global_money_format(goodsView['delivery']['firstCharge'][goodsView['selectedDeliveryPrice']]['price'])}{=gd_global_currency_string()}</span>
                                <!--{ ? addGlobalCurrency }-->
                                <span>{=gd_global_add_currency_display(goodsView['delivery']['firstCharge'][goodsView['selectedDeliveryPrice']]['price'])}</span>
                                <!--{ / }-->
                                <!--{ / }-->
                                <a class="normal-btn small1 target-delivery-add"><em>{=__('조건별배송')}<img class="arrow" src="../img/etc/bl_arrow.png" alt="" /></em></a>
                                <div class="ly_dev_wrap delivery-layer dn delivery-add">
                                    <div class="wrap">
                                        <strong style="width:auto;">{goodsView['delivery']['basic']['fixFlText']}</strong>
                                        <div>
                                            <!--{ ? gd_isset(goodsView['delivery']['basic']['fixFl']) != 'fixed'  }-->
                                            <span class="ly_btn <!--{ ? count(goodsView['delivery']['basic']['deliveryMethodFlData']) == 2 }-->two<!--{ : }-->three<!--{ / }-->">
                                                <!--{ @ goodsView['delivery']['basic']['deliveryMethodFlData']}-->
                                                <!--{ ? count(goodsView['delivery']['basic']['deliveryMethodFlData']) == 2 && ..index_ % 2 == 0 }--><span class="row"><!--{ : }--><!--{ ? ..index_ % 3 == 0 }--><span class="row"><!--{ / }--><!--{ / }-->
                                                <a class="delivery-method" onclick="selectDeliveryMethod(this, '{=..key_}')">{=..value_}</a>
                                                <!--{ ? count(goodsView['delivery']['basic']['deliveryMethodFlData']) == 2 &&  ..index_ % 2 == 1 }--></span><!--{ : }--><!--{ ? ..index_ % 3 == 2 }--></span><!--{ : }--><!--{ ? count(goodsView['delivery']['basic']['deliveryMethodFlData']) - ..index_ < 3 && ((count(goodsView['delivery']['basic']['deliveryMethodFlData']) % 3 == 1 && ..index_ % 3 == 0) || (count(goodsView['delivery']['basic']['deliveryMethodFlData']) % 3 == 2 && ..index_ % 3 == 1)) }--></span><!--{ / }--><!--{ / }--><!--{ / }-->
                                            <!--{ / }-->
                                            </span>
                                            <script type="text/javascript">
                                                function selectDeliveryMethod(e, method) {
                                                    $(e).parents(".ly_btn").find("a").removeClass("on");
                                                    $(e).addClass("on");
                                                    $('.delivery-method-tr').hide();
                                                    $('.delivery-method-tr').filter('[data-method="' + method + '"]').show();
                                                }
                                                $(function(){
                                                    $('.delivery-method').eq(0).trigger('click');
                                                })
                                            </script>
                                            <!--{ / }-->
                                            <table cellspacing="0" border="1">
                                                <!--{ ? gd_isset(goodsView['delivery']['basic']['fixFl']) == 'fixed' }-->
                                                <!--{ @ goodsView['delivery']['multiCharge'][0] }-->
                                                <!--{ ? gd_isset(..sno) }-->
                                                <tr>
                                                    <th>{=goodsView['delivery']['basic']['deliveryMethodFlData'][..key_]}</th>
                                                    <td>
                                                        {=gd_global_currency_symbol()}{=gd_global_money_format(..price)}{=gd_global_currency_string()}
                                                        <!--{ ? addGlobalCurrency }-->
                                                        <span>{=gd_global_add_currency_display(..price)}</span>
                                                        <!--{ / }-->
                                                    </td>
                                                </tr>
                                                <!--{ / }-->
                                                <!--{ / }-->
                                                <!--{ : }-->
                                                <!--{ ? gd_isset(goodsView['delivery']['basic']['rangeRepeat']) != 'y'  }-->
                                                <!--{ ? gd_isset(goodsView['delivery']['basic']['fixFl']) == 'price'  }-->
                                                <!--{ @ goodsView['delivery']['multiCharge'] }-->
                                                <!--{ @ ..value_ }-->
                                                <!--{ ? gd_isset(...sno) }-->
                                                <!--{ ? ...unitEnd > 0 }-->
                                                <tr class="delivery-method-tr" data-method="{=...key_}">
                                                    <th scope="row">{=gd_global_money_format(...unitStart)}{...unitText} {=__('이상')} ~ {=gd_global_money_format(...unitEnd)}{...unitText} {=__('미만')}</th>
                                                    <td>
                                                        {=gd_global_currency_symbol()}{=gd_global_money_format(...price)}{=gd_global_currency_string()}
                                                        <!--{ ? addGlobalCurrency }-->
                                                        <span>{=gd_global_add_currency_display(...price)}</span>
                                                        <!--{ / }-->
                                                    </td>
                                                </tr>
                                                <!--{ : }-->
                                                <tr class="delivery-method-tr" data-method="{=...key_}">
                                                    <th scope="row">{=gd_global_money_format(...unitStart)}{...unitText} {=__('이상')}</th>
                                                    <td>
                                                        {=gd_global_currency_symbol()}{=gd_global_money_format(...price)}{=gd_global_currency_string()}
                                                        <!--{ ? addGlobalCurrency }-->
                                                        <span>{=gd_global_add_currency_display(...price)}</span>
                                                        <!--{ / }-->
                                                    </td>
                                                </tr>
                                                <!--{ / }-->
                                                <!--{ / }-->
                                                <!--{ / }-->
                                                <!--{ / }-->
                                                <!--{ : gd_isset(goodsView['delivery']['basic']['fixFl']) == 'count' }-->
                                                <!--{ @ goodsView['delivery']['multiCharge'] }-->
                                                <!--{ @ ..value_ }-->
                                                <!--{ ? gd_isset(...sno) }-->
                                                <!--{ ? ...unitEnd > 0 }-->
                                                <tr class="delivery-method-tr" data-method="{=...key_}">
                                                    <th scope="row">{=number_format(...unitStart)}{...unitText} {=__('이상')} ~ {=number_format(...unitEnd)}{...unitText} {=__('미만')}</th>
                                                    <td>
                                                        {=gd_global_currency_symbol()}{=gd_global_money_format(...price)}{=gd_global_currency_string()}
                                                        <!--{ ? addGlobalCurrency }-->
                                                        <span>{=gd_global_add_currency_display(...price)}</span>
                                                        <!--{ / }-->
                                                    </td>
                                                </tr>
                                                <!--{ : }-->
                                                <tr class="delivery-method-tr" data-method="{=...key_}">
                                                    <th scope="row">{=number_format(...unitStart)}{...unitText} {=__('이상')}</th>
                                                    <td>
                                                        {=gd_global_currency_symbol()}{=gd_global_money_format(...price)}{=gd_global_currency_string()}
                                                        <!--{ ? addGlobalCurrency }-->
                                                        <span>{=gd_global_add_currency_display(...price)}</span>
                                                        <!--{ / }-->
                                                    </td>
                                                </tr>
                                                <!--{ / }-->
                                                <!--{ / }-->
                                                <!--{ / }-->
                                                <!--{ / }-->
                                                <!--{ : }-->
                                                <!--{ @ goodsView['delivery']['multiCharge'] }-->
                                                <!--{ @ ..value_ }-->
                                                <!--{ ? gd_isset(...sno) }-->
                                                <!--{ ? ...unitEnd > 0 }-->
                                                <tr class="delivery-method-tr" data-method="{=...key_}">
                                                    <th scope="row">{=number_format(...unitStart, 2)}{...unitText} {=__('이상')} ~ {=number_format(...unitEnd, 2)}{...unitText} {=__('미만')}</th>
                                                    <td>
                                                        {=gd_global_currency_symbol()}{=gd_global_money_format(...price)}{=gd_global_currency_string()}
                                                        <!--{ ? addGlobalCurrency }-->
                                                        <span>{=gd_global_add_currency_display(...price)}</span>
                                                        <!--{ / }-->
                                                    </td>
                                                </tr>
                                                <!--{ : }-->
                                                <tr class="delivery-method-tr" data-method="{=...key_}">
                                                    <th scope="row">{=number_format(...unitStart, 2)}{...unitText} {=__('이상')}</th>
                                                    <td>
                                                        {=gd_global_currency_symbol()}{=gd_global_money_format(...price)}{=gd_global_currency_string()}
                                                        <!--{ ? addGlobalCurrency }-->
                                                        <span>{=gd_global_add_currency_display(...price)}</span>
                                                        <!--{ / }-->
                                                    </td>
                                                </tr>
                                                <!--{ / }-->
                                                <!--{ / }-->
                                                <!--{ / }-->
                                                <!--{ / }-->
                                                <!--{ / }-->
                                                <!--{ : }-->
                                                <!--{ @ goodsView['delivery']['multiCharge'] }-->
                                                <!--{ @ ..value_ }-->
                                                <!--{ ? gd_isset(...sno) }-->
                                                <!--{ ? ..index_ == 0 }-->
                                                <tr class="delivery-method-tr" data-method="{=...key_}">
                                                    <th scope="row">
                                                        <!--{ ? gd_isset(goodsView['delivery']['basic']['fixFl']) == 'price'  }-->
                                                        {=gd_global_money_format(...unitStart)}
                                                        <!--{ : gd_isset(goodsView['delivery']['basic']['fixFl']) == 'count' }-->
                                                        {=number_format(...unitStart)}
                                                        <!--{ : }-->
                                                        {=number_format(...unitStart, 2)}
                                                        <!--{ / }-->
                                                        {...unitText} {=__('이상')} ~
                                                        <!--{ ? gd_isset(goodsView['delivery']['basic']['fixFl']) == 'price'  }-->
                                                        {=gd_global_money_format(...unitEnd)}
                                                        <!--{ : gd_isset(goodsView['delivery']['basic']['fixFl']) == 'count' }-->
                                                        {=number_format(...unitEnd)}
                                                        <!--{ : }-->
                                                        {=number_format(...unitEnd, 2)}
                                                        <!--{ / }-->
                                                        {...unitText} {=__('미만')}
                                                    </th>
                                                    <td>
                                                        {=gd_global_currency_symbol()}{=gd_global_money_format(...price)}{=gd_global_currency_string()}
                                                        <!--{ ? addGlobalCurrency }-->
                                                        <span>{=gd_global_add_currency_display(...price)}</span>
                                                        <!--{ / }-->
                                                    </td>
                                                </tr>
                                                <!--{ : }-->
                                                <tr class="delivery-method-tr" data-method="{=...key_}">
                                                    <th scope="row">
                                                        <!--{ ? gd_isset(goodsView['delivery']['basic']['fixFl']) == 'price'  }-->
                                                        {=gd_global_money_format(...unitStart)}
                                                        <!--{ : gd_isset(goodsView['delivery']['basic']['fixFl']) == 'count' }-->
                                                        {=number_format(...unitStart)}
                                                        <!--{ : }-->
                                                        {=number_format(...unitStart, 2)}
                                                        <!--{ / }-->
                                                        {...unitText} {=__('이상')}
                                                        <!--{ ? gd_isset(goodsView['delivery']['basic']['fixFl']) == 'price'  }-->
                                                        {=gd_global_money_format(...unitEnd)}
                                                        <!--{ : gd_isset(goodsView['delivery']['basic']['fixFl']) == 'count' }-->
                                                        {=number_format(...unitEnd)}
                                                        <!--{ : }-->
                                                        {=number_format(...unitEnd, 2)}
                                                        <!--{ / }-->
                                                        {...unitText} {=__('마다 추가')}
                                                    </th>
                                                    <td>
                                                        {=gd_global_currency_symbol()}{=gd_global_money_format(...price)}{=gd_global_currency_string()}
                                                        <!--{ ? addGlobalCurrency }-->
                                                        <span>{=gd_global_add_currency_display(...price)}</span>
                                                        <!--{ / }-->
                                                    </td>
                                                </tr>
                                                <!--{ / }-->
                                                <!--{ / }-->
                                                <!--{ / }-->
                                                <!--{ / }-->
                                                <!--{ / }-->
                                                <!--{ / }-->
                                            </table>
                                            <!--{ ? goodsView.delivery.basic.fixFl == 'price' }-->
                                            <p class="caution-msg1">
                                                {=__('배송비 계산 기준 : 판매가')}
                                                <!--{ ? in_array('option',goodsView.delivery.basic.pricePlusStandard) }-->
                                                + {=__('옵션가')}
                                                <!--{ / }-->
                                                <!--{ ? in_array('add',goodsView.delivery.basic.pricePlusStandard) }-->
                                                + {=__('추가상품가')}
                                                <!--{ / }-->
                                                <!--{ ? in_array('text',goodsView.delivery.basic.pricePlusStandard) }-->
                                                + {=__('텍스트옵션가')}
                                                <!--{ / }-->
                                                <!--{ ? in_array('goods',goodsView.delivery.basic.priceMinusStandard) }-->
                                                - {=__('상품할인가')}
                                                <!--{ / }-->
                                                <!--{ ? in_array('coupon',goodsView.delivery.basic.priceMinusStandard) }-->
                                                - {=__('상품쿠폰할인가')}
                                                <!--{ / }-->
                                            </p>
                                            <!--{ / }-->
                                        </div>
                                        <button type="button" class="target-delivery-add" title="{=__('닫기')}">{=__('닫기')}</button>
                                    </div>
                                </div>
                                <!--{ : }-->
                                <!--{ ? gd_isset(goodsView['delivery']['basic']['fixFl']) == 'free'  }-->
                                <span>{=__('무료')}</span>
                                <!--{ : gd_isset(goodsView['delivery']['basic']['fixFl']) == 'fixed'  }-->
                                <span>{=gd_global_currency_symbol()}{=gd_global_money_format(goodsView['delivery']['charge']['0']['price'])}{=gd_global_currency_string()}</span>
                                <!--{ ? addGlobalCurrency }-->
                                <span>{=gd_global_add_currency_display(goodsView['delivery']['charge']['0']['price'])}</span>
                                <!--{ / }-->
                                <!--{ : }-->
                                <span>{=gd_global_currency_symbol()}{=gd_global_money_format(goodsView['delivery']['charge'][goodsView['selectedDeliveryPrice']]['price'])}{=gd_global_currency_string()}</span>
                                <!--{ ? addGlobalCurrency }-->
                                <span>{=gd_global_add_currency_display(goodsView['delivery']['charge'][goodsView['selectedDeliveryPrice']]['price'])}</span>
                                <!--{ / }-->
                                <a class="normal-btn small1 target-delivery-add"><em>{=__('조건별배송')}<img class="arrow" src="../img/etc/bl_arrow.png" alt="" /></em></a>
                                <div class="delivery-layer dn delivery-add">
                                    <div class="wrap">
                                        <strong style="width:auto;">{goodsView['delivery']['basic']['fixFlText']}</strong>
                                        <div>
                                            <table cellspacing="0" border="1">
                                                <!--{ ? gd_isset(goodsView['delivery']['basic']['rangeRepeat']) != 'y'  }-->
                                                <!--{ ? gd_isset(goodsView['delivery']['basic']['fixFl']) == 'price'  }-->
                                                <!--{ @ goodsView['delivery']['charge'] }-->
                                                <!--{ ? ..unitEnd > 0 }-->
                                                <tr>
                                                    <th scope="row">{=gd_global_money_format(..unitStart)}{..unitText} {=__('이상')} ~ {=gd_global_money_format(..unitEnd)}{..unitText} {=__('미만')}</th>
                                                    <td>
                                                        {=gd_global_currency_symbol()}{=gd_global_money_format(..price)}{=gd_global_currency_string()}
                                                        <!--{ ? addGlobalCurrency }-->
                                                        <span>{=gd_global_add_currency_display(..price)}</span>
                                                        <!--{ / }-->
                                                    </td>
                                                </tr>
                                                <!--{ : }-->
                                                <tr>
                                                    <th scope="row">{=gd_global_money_format(..unitStart)}{..unitText} {=__('이상')}</th>
                                                    <td>
                                                        {=gd_global_currency_symbol()}{=gd_global_money_format(..price)}{=gd_global_currency_string()}
                                                        <!--{ ? addGlobalCurrency }-->
                                                        <span>{=gd_global_add_currency_display(..price)}</span>
                                                        <!--{ / }-->
                                                    </td>
                                                </tr>
                                                <!--{ / }-->
                                                <!--{ / }-->
                                                <!--{ : gd_isset(goodsView['delivery']['basic']['fixFl']) == 'count' }-->
                                                <!--{ @ goodsView['delivery']['charge'] }-->
                                                <!--{ ? ..unitEnd > 0 }-->
                                                <tr>
                                                    <th scope="row">{=number_format(..unitStart)}{..unitText} {=__('이상')} ~ {=number_format(..unitEnd)}{..unitText} {=__('미만')}</th>
                                                    <td>
                                                        {=gd_global_currency_symbol()}{=gd_global_money_format(..price)}{=gd_global_currency_string()}
                                                        <!--{ ? addGlobalCurrency }-->
                                                        <span>{=gd_global_add_currency_display(..price)}</span>
                                                        <!--{ / }-->
                                                    </td>
                                                </tr>
                                                <!--{ : }-->
                                                <tr>
                                                    <th scope="row">{=number_format(..unitStart)}{..unitText} {=__('이상')}</th>
                                                    <td>
                                                        {=gd_global_currency_symbol()}{=gd_global_money_format(..price)}{=gd_global_currency_string()}
                                                        <!--{ ? addGlobalCurrency }-->
                                                        <span>{=gd_global_add_currency_display(..price)}</span>
                                                        <!--{ / }-->
                                                    </td>
                                                </tr>
                                                <!--{ / }-->
                                                <!--{ / }-->
                                                <!--{ : }-->
                                                <!--{ @ goodsView['delivery']['charge'] }-->
                                                <!--{ ? ..unitEnd > 0 }-->
                                                <tr>
                                                    <th scope="row">{=number_format(..unitStart, 2)}{..unitText} {=__('이상')} ~ {=number_format(..unitEnd, 2)}{..unitText} {=__('미만')}</th>
                                                    <td>
                                                        {=gd_global_currency_symbol()}{=gd_global_money_format(..price)}{=gd_global_currency_string()}
                                                        <!--{ ? addGlobalCurrency }-->
                                                        <span>{=gd_global_add_currency_display(..price)}</span>
                                                        <!--{ / }-->
                                                    </td>
                                                </tr>
                                                <!--{ : }-->
                                                <tr>
                                                    <th scope="row">{=number_format(..unitStart, 2)}{..unitText} {=__('이상')}</th>
                                                    <td>
                                                        {=gd_global_currency_symbol()}{=gd_global_money_format(..price)}{=gd_global_currency_string()}
                                                        <!--{ ? addGlobalCurrency }-->
                                                        <span>{=gd_global_add_currency_display(..price)}</span>
                                                        <!--{ / }-->
                                                    </td>
                                                </tr>
                                                <!--{ / }-->
                                                <!--{ / }-->
                                                <!--{ / }-->
                                                <!--{ : }-->
                                                <!--{ @ goodsView['delivery']['charge'] }-->
                                                <!--{ ? ..index_ == 0 }-->
                                                <tr>
                                                    <th scope="row">
                                                        <!--{ ? gd_isset(goodsView['delivery']['basic']['fixFl']) == 'price'  }-->
                                                        {=gd_global_money_format(..unitStart)}
                                                        <!--{ : gd_isset(goodsView['delivery']['basic']['fixFl']) == 'count' }-->
                                                        {=number_format(..unitStart)}
                                                        <!--{ : }-->
                                                        {=number_format(..unitStart, 2)}
                                                        <!--{ / }-->
                                                        {..unitText} {=__('이상')} ~
                                                        <!--{ ? gd_isset(goodsView['delivery']['basic']['fixFl']) == 'price'  }-->
                                                        {=gd_global_money_format(..unitEnd)}
                                                        <!--{ : gd_isset(goodsView['delivery']['basic']['fixFl']) == 'count' }-->
                                                        {=number_format(..unitEnd)}
                                                        <!--{ : }-->
                                                        {=number_format(..unitEnd, 2)}
                                                        <!--{ / }-->
                                                        {..unitText} {=__('미만')}
                                                    </th>
                                                    <td>
                                                        {=gd_global_currency_symbol()}{=gd_global_money_format(..price)}{=gd_global_currency_string()}
                                                        <!--{ ? addGlobalCurrency }-->
                                                        <span>{=gd_global_add_currency_display(..price)}</span>
                                                        <!--{ / }-->
                                                    </td>
                                                </tr>
                                                <!--{ : }-->
                                                <tr>
                                                    <th scope="row">
                                                        <!--{ ? gd_isset(goodsView['delivery']['basic']['fixFl']) == 'price'  }-->
                                                        {=gd_global_money_format(..unitStart)}
                                                        <!--{ : gd_isset(goodsView['delivery']['basic']['fixFl']) == 'count' }-->
                                                        {=number_format(..unitStart)}
                                                        <!--{ : }-->
                                                        {=number_format(..unitStart, 2)}
                                                        <!--{ / }-->
                                                        {..unitText} {=__('이상')}
                                                        <!--{ ? gd_isset(goodsView['delivery']['basic']['fixFl']) == 'price'  }-->
                                                        {=gd_global_money_format(..unitEnd)}
                                                        <!--{ : gd_isset(goodsView['delivery']['basic']['fixFl']) == 'count' }-->
                                                        {=number_format(..unitEnd)}
                                                        <!--{ : }-->
                                                        {=number_format(..unitEnd, 2)}
                                                        <!--{ / }-->
                                                        {..unitText} {=__('마다 추가')}
                                                    </th>
                                                    <td>
                                                        {=gd_global_currency_symbol()}{=gd_global_money_format(..price)}{=gd_global_currency_string()}
                                                        <!--{ ? addGlobalCurrency }-->
                                                        <span>{=gd_global_add_currency_display(..price)}</span>
                                                        <!--{ / }-->
                                                    </td>
                                                </tr>
                                                <!--{ / }-->
                                                <!--{ / }-->
                                                <!--{ / }-->
                                            </table>
                                            <!--{ ? goodsView.delivery.basic.fixFl == 'price' }-->
                                            <p class="caution-msg1">
                                                {=__('배송비 계산 기준 : 판매가')}
                                                <!--{ ? in_array('option',goodsView.delivery.basic.pricePlusStandard) }-->
                                                + {=__('옵션가')}
                                                <!--{ / }-->
                                                <!--{ ? in_array('add',goodsView.delivery.basic.pricePlusStandard) }-->
                                                + {=__('추가상품가')}
                                                <!--{ / }-->
                                                <!--{ ? in_array('text',goodsView.delivery.basic.pricePlusStandard) }-->
                                                + {=__('텍스트옵션가')}
                                                <!--{ / }-->
                                                <!--{ ? in_array('goods',goodsView.delivery.basic.priceMinusStandard) }-->
                                                - {=__('상품할인가')}
                                                <!--{ / }-->
                                                <!--{ ? in_array('coupon',goodsView.delivery.basic.priceMinusStandard) }-->
                                                - {=__('상품쿠폰할인가')}
                                                <!--{ / }-->
                                            </p>
                                            <!--{ / }-->
                                        </div>
                                        <button type="button" class="target-delivery-add" title="{=__('닫기')}">{=__('닫기')}</button>
                                    </div>
                                </div>
                                <!--{ / }-->
                                <!--{ / }-->
                                <!--{ ? gd_isset(goodsView['delivery']['basic']['areaFl']) == 'y'  }-->
                                <a class="normal-btn small1 target-delivery-area" ><em>{=__('지역별추가배송비')}<img class="arrow" src="../img/etc/bl_arrow.png" alt="" /></em></a>
                                <div class="delivery-layer dn delivery-area">
                                    <div class="wrap">
                                        <strong style="width:auto;">{=__('지역별배송비')}</strong>
                                        <div>
                                            <table cellspacing="0" border="1">
                                                <!--{ @ goodsView['delivery']['areaDetail'] }-->
                                                <tr>
                                                    <th scope="row">{..addArea}</th>
                                                    <td>
                                                        {=gd_global_currency_symbol()}{=gd_global_money_format(..addPrice)}{=gd_global_currency_string()}
                                                        <!--{ ? addGlobalCurrency }-->
                                                        <span>{=gd_global_add_currency_display(..addPrice)}</span>
                                                        <!--{ / }-->
                                                    </td>
                                                </tr>
                                                <!--{ / }-->
                                            </table>
                                        </div>
                                        <button type="button" class="target-delivery-area" title="{=__('닫기')}">{=__('닫기')}</button>
                                    </div>
                                </div>
                                <!--{ / }-->

                                <div class="detail">
                                    <!--{ ? count(goodsView['delivery']['basic']['deliveryMethodFlData']) > 0  }-->
                                    <!--{ ? count(goodsView['delivery']['basic']['deliveryMethodFlData']) == 1  }-->
                                    <!--{ @ goodsView['delivery']['basic']['deliveryMethodFlData'] }-->
                                    <input type="hidden" name="deliveryMethodFl" value="{..key_}" />
                                    {..value_}
                                    <!--{ / }-->
                                    <!--{ : }-->
                                    <select class="tune js-deliveryMethodFl" name="deliveryMethodFl" style="min-width: 100px; width: auto; max-width: 150px;">
                                        <!--{ @ goodsView['delivery']['basic']['deliveryMethodFlData'] }-->
                                        <option value="{..key_}" <!--{ ? optionInfo['deliveryMethodFl'] == ..key_ }-->selected="selected"<!--{ / }-->>{..value_}</option>
                                        <!--{ / }-->
                                    </select>
                                    <!--{ / }-->
                                    <!--{ / }-->

                                    <!--{ ? gd_isset(goodsView['delivery']['basic']['fixFl']) != 'free' }-->
                                    &nbsp;/&nbsp;
                                    <!--{ ? gd_isset(goodsView['delivery']['basic']['collectFl']) == 'pre'  }-->
                                    <span><input type="hidden" name="deliveryCollectFl" value="pre" /></span>
                                    {=__('주문시결제')}({=__('선결제')})
                                    <!--{ : gd_isset(goodsView['delivery']['basic']['collectFl']) == 'later'  }-->
                                    <span><input type="hidden" name="deliveryCollectFl" value="later" /></span>
                                    {=__('상품수령시결제')}({=__('착불')})
                                    <!--{ : }-->
                                    <span class="st-hs">
                                    <select class="tune" name="deliveryCollectFl" style="width:155px">
                                        <option value="pre" <!--{ ? optionInfo['deliveryCollectFl'] == 'pre' }-->selected="selected"<!--{ / }-->>{=__('주문시결제')}({=__('선결제')})</option>
                                        <option value="later" <!--{ ? optionInfo['deliveryCollectFl'] == 'later' }-->selected="selected"<!--{ / }-->>{=__('상품수령시결제')}({=__('착불')})</option>
                                    </select>
                                    </span>
                                    <!--{ / }-->
                                    <!--{ / }-->

                                    <!--{ ? goodsView['delivery']['basic']['deliveryMethodVisitArea'] && goodsView['delivery']['basic']['dmVisitTypeDisplayFl'] != 'y'}-->
                                    <div class="js-deliveryMethodVisitArea <!--{ ? count(goodsView['delivery']['basic']['deliveryMethodFlData']) != 1 || !goodsView['delivery']['basic']['deliveryMethodFlData']['visit'] }-->dn<!--{ / }-->">
                                        {=__('방문 수령지')} : {=goodsView['delivery']['basic']['deliveryMethodVisitArea']}
                                    </div>
                                    <!--{ / }-->
                                </div>
                            </div>
                            </div>
                        </div>
                        <!--{ / }-->
                        <!--{ / }-->

                        <!-- 옵션 있을때시작 -->
                        <!--{ ? goodsView['optionFl'] == 'y' }-->

                        <!--{ ? goodsView['optionDisplayFl'] == 's' }-->
                        <div class="ag-choice choice">
                            <div class="list">
                                <strong><!--{ ? goodsView['optionEachCntFl'] == 'one' && empty(goodsView['optionName']) === false }-->{=goodsView['optionName']}<!--{ : }-->{=__('옵션 선택')}<!--{ / }-->  </strong>
                                <div>
                                    <select name="optionSnoInput" class="tune" style="width:100%" onchange="goodsViewLayerController.option_price_display(this);"<!--{ ? goodsView['orderPossible'] != 'y' }--> disabled="disabled"<!--{ / }-->>
                                        <option value="">=
                                            <!--{ ? goodsView['optionEachCntFl'] == 'many' && empty(goodsView['optionName']) === false }-->{=goodsView['optionName']}
                                            <!--{ : }-->{=__('옵션')}
                                            <!--{ / }-->: {=__('가격')}
                                            <!--{ ? in_array('optionStock',displayAddField) }-->: {=__('재고')}<!--{ / }-->
                                            =
                                        </option>
                                        <!--{ @ goodsView['option'] }-->
                                        <!--{ ? .optionViewFl =='y' }-->
                                        <option <!--{ ? goodsView['optionIcon']['goodsImage'] }--><!--{ ? .optionImage }-->data-img-src="{=.optionImage}"  <!--{ : }-->data-img-src="blank"<!--{ / }--> <!--{ / }--> value="{=.sno}{=c.INT_DIVISION}{=gd_global_money_format(.optionPrice,false)}{=c.INT_DIVISION}{=.mileage}{=c.INT_DIVISION}{=.stockCnt}{=c.STR_DIVISION}{.optionValue}<!--{ ? (goodsView['stockFl'] == 'y' && .optionSellFl == 't') }-->{=c.INT_DIVISION}[<!--{=optionSoldOutCode[.optionSellCode]}-->]<!--{ / }--><!--{ ? .optionDeliveryFl == 't' && optionDeliveryDelayCode[.optionDeliveryCode] != '' }-->[<!--{=optionDeliveryDelayCode[.optionDeliveryCode]}-->]<!--{ / }-->"<!--{ ? (goodsView['stockFl'] == 'y' && goodsView['stockCnt'] <  goodsView['minOrderCnt']) || (goodsView['stockFl'] == 'y' && goodsView['fixedOrderCnt'] == 'option' && .stockCnt < goodsView['minOrderCnt']) || (goodsView['stockFl'] == 'y' && .stockCnt == '0') || .optionSellFl =='n' || .optionSellFl =='t' }-->disabled="disabled"
                                        <!--{ / }--> <!--{ ? gd_isset(optionInfo['optionSno']) && optionInfo['optionSno'] == .sno }--> selected='selected' <!--{ / }-->> {=.optionValue}
                                        <!--{ ? gd_isset(.optionPrice) != '0'  }-->  : {=gd_global_currency_symbol()}<!--{ ? gd_isset(.optionPrice) > 0   }-->+<!--{ / }-->{=gd_global_money_format(.optionPrice)}{=gd_global_currency_string()} <!--{ / }-->
                                        <!--{ ? .optionSellFl == 't' }-->[<!--{=optionSoldOutCode[.optionSellCode]}-->]
                                        <!--{ : (goodsView['stockFl'] == 'y' && .stockCnt == '0') || .optionSellFl ==  'n' }-->[<!--{=optionSoldOutCode['n']}-->]
                                        <!--{ : }-->
                                        <!--{ ? in_array('optionStock',displayAddField) && goodsView['stockFl'] == 'y' }--> : {=number_format(.stockCnt)}{=__('개')}
                                        <!--{ / }-->
                                        <!--{ / }-->
                                        <!--{ ? .optionDeliveryFl == 't' && optionDeliveryDelayCode[.optionDeliveryCode] != '' }-->[<!--{=optionDeliveryDelayCode[.optionDeliveryCode]}-->]
                                        <!--{ / }-->
                                        </option>
                                        <!--{ / }-->
                                        <!--{ / }-->
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!--{ : goodsView['optionDisplayFl'] == 'd' }-->

                        <!--{ @ goodsView['optionName'] }-->
                        <!--{ ? .index_ == 0 }-->
                        <input type="hidden" name="optionSnoInput" value="<!--{ ? optionInfo['optionSnoText'] }-->{=optionInfo['optionSnoText']}<!--{ / }-->" />
                        <input type="hidden" name="optionCntInput" value="{=.size_}" />
                        <!--{ / }-->
                        <div class="ag-choice choice">
                            <div class="list">
                                <strong>{=.value_}</strong>
                                <div>
                                    <select name="optionNo_{=.index_}" class="tune" style="width:100%;"  onchange="goodsViewLayerController.option_select(this,'{=.index_}', '{=gd_isset(goodsView['optionName'][(.index_ + 1)])}','<!--{ ? in_array('optionStock',displayAddField) }-->y<!--{ : }-->n<!--{ / }-->');"
                                    <!--{ ? goodsView['orderPossible'] != 'y' || .index_ > 0 }--> disabled="disabled"
                                    <!--{ / }-->>
                                    <option value="">=
                                        <!--{ ? .index_ == 0 }-->{=.value_} {=__('선택')}
                                        <!--{ : }-->{=__('%s을 먼저 선택해 주세요', goodsView['optionName'][(.index_ - 1)])}
                                        <!--{ / }--> =
                                    </option>
                                    <!--{ ? .index_ == 0 }-->
                                    <!--{ @ goodsView['optionDivision'] }-->
                                    <option   <!--{ ? goodsView['optionIcon']['goodsImage'] }--><!--{ ? goodsView['optionIcon']['goodsImage'][..value_] }--> data-img-src="{=goodsView['optionIcon']['goodsImage'][..value_]}" <!--{ : }-->data-img-src="blank" <!--{ / }--><!--{ / }--> value="{=..value_}" <!--{ ? (goodsView['stockFl'] == 'y' && goodsView['stockCnt'] < goodsView['minOrderCnt']) || (goodsView['stockFl'] == 'y' && goodsView['fixedOrderCnt'] == 'option' && isset(goodsView['optionDivisionStock']) && isset(goodsView['optionDivisionStock'][..key_]['stockCnt']) && goodsView['optionDivisionStock'][..key_]['stockCnt'] < goodsView['minOrderCnt']) || (goodsView['stockFl'] == 'y' && goodsView['optionDivisionStock'][..key_]['stockCnt'] == '0') || goodsView['optionDivisionStock'][..key_]['optionSellFl'] ==  'n' || goodsView['optionDivisionStock'][..key_]['optionSellFl'] ==  't' }--> disabled="disabled"<!--{ / }-->>
                                        {=..value_}
                                        <!--{ ? (goodsView['optionDivisionStock'][..key_]['optionSellFl'] == 't') }-->[<!--{=optionSoldOutCode[goodsView['optionDivisionStock'][..key_]['optionSellCode']]}-->]
                                        <!--{ : (goodsView['stockFl'] == 'y' && goodsView['optionDivisionStock'][..key_]['stockCnt'] == '0') || goodsView['optionDivisionStock'][..key_]['optionSellFl'] ==  'n' }-->[<!--{=optionSoldOutCode['n']}-->]
                                        <!--{ / }-->
                                    </option>
                                    <!--{ / }-->
                                    <!--{ / }-->
                                    </select></div>
                            </div>
                        </div>
                        <div id="iconImage_{=.index_}" class="option_icon"></div>
                        <!--{ / }-->
                        <!--{ / }-->
                        <!--{ / }-->
                        <!--  옵션 끝 -->


                        <!--{ ? goodsView['optionTextFl'] == 'y' }-->

                        <!-- 추가 옵션 입력형 시작-->
                        <!--{ @ goodsView['optionText'] }-->
                        <div class="ag-choice choice">
                            <div class="list">
                                <!--{ ? .index_ == 0 }-->
                                <input type="hidden" id="optionTextCnt" value="{=.size_}" />
                                <!--{ / }-->
                                <strong><span class="optionTextNm_{=.index_}">{=.optionName}<!--{ ? .mustFl == 'y' }--><em>({=__('필수')})</em><!--{ / }--></span> <input type="hidden" name="optionTextMust_{=.index_}" value="{=.mustFl}" /> <input type="hidden" name="optionTextLimit_{=.index_}" value="{=.inputLimit}" /></strong>

                                <div class="option_input optionTextDisplay{=.sno}">
                    <span class="txt-field<!--{ ? goodsView['orderPossible'] != 'y' }--> disabled<!--{ / }-->">
                    <input type="hidden" name="optionTextSno_{=.index_}" value="{=.sno}"/>
                    <input type="text" name="optionTextInput_{=.index_}" value="" size="25" class="text" data-sno ="{=.sno}" onchange="goodsViewLayerController.option_text_select(this)" placeholder="{=.inputLimit}{=__('글자를 입력하세요.')}" maxlength="{=.inputLimit}"<!--{ ? goodsView['orderPossible'] != 'y' }--> disabled="disabled"<!--{ / }-->/>
                    <input type="hidden"  value="{=.addPrice}"/>
                    </span>
                                    <!--{ ? .addPrice != 0 }-->
                                    <span class="msg">※ {=__('작성시')} {=gd_global_currency_symbol()}{=gd_global_money_format(.addPrice)}{=gd_global_currency_string()} {=__('추가')}</span>
                                    <!--{ / }-->
                                </div>
                            </div>
                        </div>
                        <!--{ / }-->
                        <!--{ / }-->
                        <!-- 추가 옵션 입력형 종료 -->

                        <!--{ ? goodsView['addGoods'] }-->
                        <!--{ @ goodsView['addGoods'] }-->
                        <div class="ag-choice choice <!--{ ? .key_ == '0'}-->add  <!--{ / }-->">
                            <div class="list">
                                <strong>{=.title}  <!--{ ? .mustFl =='y' }--><em>({=__('필수')})</em><input type="hidden" name="addGoodsInputMustFl[]" value="{.key_}"><!--{ / }--></strong>
                                <div>
                                    <select name="addGoodsInput{.key_}"   data-key="{.key_}" class="tune" style="width:100%;"  onchange="goodsViewLayerController.add_goods_select(this)"<!--{ ? goodsView['orderPossible'] != 'y' }--> disabled="disabled"<!--{ / }-->>
                                        <option value="">{=__('추가상품')}</option>
                                        <!--{ @ .addGoodsList }-->
                                        <option <!--{ ? .addGoodsImageFl=='y' }--><!--{ ? ..imageSrc }--> data-img-src="{..imageSrc}" <!--{ : }-->data-img-src="blank" <!--{ / }--><!--{ / }--> value="{=..addGoodsNo}{=c.INT_DIVISION}{=..goodsPrice}{=c.STR_DIVISION}{=..goodsNm}({=..optionNm}){=c.STR_DIVISION}{=rawurlencode(gd_html_add_goods_image(..addGoodsNo, ..imageNm, ..imagePath, ..imageStorage, 30, ..goodsNm, '_blank'))}{=c.STR_DIVISION}{=.key_}{=c.STR_DIVISION}{=..stockUseFl}{=c.STR_DIVISION}{=..stockCnt}" <!--{ ? ..soldOutFl =='y' || (..stockUseFl =='1' && ..stockCnt == '0')  }--> disabled="disabled" <!--{ / }-->>{=..goodsNm}  ({=..optionNm} <!--{ ? gd_isset(..goodsPrice) != '0'  }-->  / {=gd_global_currency_symbol()}<!--{ ? gd_isset(..goodsPrice) > 0   }-->+<!--{ / }-->{=gd_global_money_format(..goodsPrice)}{=gd_global_currency_string()} <!--{ / }--> <!--{ ? ..soldOutFl =='y' || (..stockUseFl =='1' && ..stockCnt == '0')  }--> / {=__('품절')} <!--{ / }-->)</option>
                                        <!--{ / }-->
                                    </select>
                                </div>
                            </div>
                        </div>
                        <!--{ / }-->
                        <!--{ / }-->


                    </div>
                    <!--{ ?goodsView['orderPossible'] == 'y' }-->
                    <!--{ ? goodsView['optionFl'] == 'y' }-->
                    <div class="option_total_display_area" style="display:none">
                        <div class="order-goods option_display_area" ></div>
                    </div>
                    <!--{ : }-->
                    <div class="order-goods option_display_area">
                        <div class="option_display_item_0" id="option_display_item_0">
                            <input type="hidden" name="goodsNo[]" value="{=goodsView['goodsNo']}">
                            <input type="hidden" name="optionSno[]" value="{=gd_isset(goodsView['option'][0]['sno'])}"/>
                            <input type="hidden" name="goodsPriceSum[]" value="0">
                            <input type="hidden" name="addGoodsPriceSum[]" value="0">
                            <div class="check optionKey_0">
                            <span class="name"><strong>{=gd_isset(goodsView['goodsNmDetail'])}</strong>
                                <span id="option_text_display_0"></span></span>

                                <div class="price">
                                        <span class="count">
                                                         <input type="text" class="text goodsCnt_0" title="{=__('수량')}" name="goodsCnt[]"  value="{=gd_isset(goodsView['defaultGoodsCnt'])}" data-value="{=gd_isset(goodsView['defaultGoodsCnt'])}"  data-stock="{=goodsView['totalStock']}" data-key="0" onchange="goodsViewLayerController.input_count_change(this,'1');return false;">

                                            <span>
                                                <button type="button" class="up goods-cnt" title="{=__('증가')}"  value="up{=c.STR_DIVISION}0" style="cursor: pointer">{=__('증가')}</button>
                                                <button type="button" class="down goods-cnt" title="{=__('감소')}" value="dn{=c.STR_DIVISION}0" style="cursor: pointer">{=__('감소')}</button>
                                            </span>
                                        </span>

                                    <em><input type="hidden" value="{=gd_isset(goodsView['option'][0]['optionPrice'],0)}" name="optionPriceSum[]"> <input type="hidden" value="{=gd_isset(goodsView['option'][0]['optionPrice'])}" name="option_price_0">{=gd_global_currency_symbol()}<strong class="option_price_display_0">{=gd_global_money_format(gd_isset(goodsView['option'][0]['optionPrice'],0),false)}</strong>{=gd_global_currency_string()}</em>

                                </div>
                            </div>
                        </div>
                    </div>
                    <!--{ / }-->
                    <!--{ / }-->
                </div>
            </div>
            <div class="btn">
                <!--{ ? goodsView['orderPossible'] == 'y' }-->
                <a class="skinbtn point1 layer-close btn-close"><em>{=__('취소')}</em></a>
                <a class="skinbtn point2 layerboard-save" id="btnToCart"><em>{=__('확인')}</em></a>
                <!--{ : }-->
                <a class="skinbtn point2 gv-notorderpossible soldout"><em>{=__('구매 불가')}</em></a>
                <!--{ / }-->
            </div>
            <button title="{=__('닫기')}" class="close" type="button">{=__('닫기')}</button>
        </div>
    </form>
</div>

<script type="text/javascript" src="../js/jquery/chosen-imageselect/src/ImageSelect.jquery.js"></script>
<link type="text/css" rel="stylesheet" href="../js/jquery/chosen-imageselect/src/ImageSelect.css" />


<!-- //옵션변경 레이어 -->
<script type="text/javascript">
    <!--
    var goodsTotalCnt;
    var goodsOptionCnt = [];
    $(document).ready(function(){

        var parameters		= {
            'setTemplate' : 'Layer',
            'setControllerName' : goodsViewLayerController,
            'setOptionFl' : '{=goodsView['optionFl']}',
            'setOptionTextFl'	: '{=goodsView['optionTextFl']}',
            'setOptionDisplayFl'	: '{=goodsView['optionDisplayFl']}',
            'setAddGoodsFl'	: '<!--{ ? is_array(goodsView['addGoods']) }-->y<!--{ : }-->n<!--{ / }-->',
            'setIntDivision'	: '{=c.INT_DIVISION}',
            'setStrDivision'	: '{=c.STR_DIVISION}',
            'setMileageUseFl'	: '{=mileageData['useFl']}',
            'setCouponUseFl'	: '{=couponUse}',
            'setMinOrderCnt'	: '{=goodsView['minOrderCnt']}',
            'setMaxOrderCnt'	: '{=goodsView['maxOrderCnt']}',
            'setStockFl'	: '{=gd_isset(goodsView['stockFl'])}',
            'setSalesUnit' : '{=gd_isset(goodsView['salesUnit'],1)}',
            'setDecimal' : '{currency.decimal}',
            'setGoodsPrice' : '{=gd_isset(goodsView['goodsPrice'],0)}',
            'setGoodsNo' : '{=goodsView['goodsNo']}',
            'setMileageFl' : ' {=goodsView['mileageFl']}',
            'setGoodsNm': "{=goodsView['goodsNm']}",
            'setImage': "{=goodsView['social']}",
            'setFixedSales' : "{=goodsView['fixedSales']}",
            'setFixedOrderCnt' : "{=goodsView['fixedOrderCnt']}",
            'setOptionPriceFl' : '{=optionPriceFl}',
            'setStockCnt' : '{=goodsView["stockCnt"]}'
        };

        goodsViewLayerController.init(parameters);

        <!--{ ? goodsView['optionFl']== 'n' }-->
        goodsViewLayerController.goods_calculate('#frmViewLayer',1,0,"{=gd_isset(goodsView['defaultGoodsCnt'])}");
        <!--{ / }-->

        $('#frmViewLayer button.goods-cnt').on('click', function(e){
            goodsViewLayerController.count_change(this,1);
        });

        $('button.add-goods-cnt').on('click', function(e){
            goodsViewLayerController.count_change(this);
        });

        var salesUnit = parseInt("{=gd_isset(goodsView['salesUnit'],1)}");
        var minOrderCnt = parseInt("{=gd_isset(goodsView['minOrderCnt'],1)}");
        var maxOrderCnt = parseInt("{=gd_isset(goodsView['maxOrderCnt'],0)}");
        $('#btnToCart').on('click', function(e){
            <!--{ ? goodsView['optionFl'] == 'y'}-->
            var goodsInfo		= $('#frmViewLayer input[name*=\'optionSno[]\']').length;
            <!--{ : }-->
            var goodsInfo		= $('#frmViewLayer input[name="optionSnoInput"]').val();
            <!--{ / }-->
            if (goodsInfo == '') {
                alert("{=__('가격 정보가 없거나 옵션이 선택되지 않았습니다!')}");
                return false;
            }

            <!--{ ? gd_isset(goodsView['optionTextFl']) == 'y' }-->
            if(!goodsViewLayerController.option_text_valid("#frmViewLayer"))
            {
                alert("{=__('입력 옵션을 확인해주세요.')}");
                return false;
            }
            <!--{ / }-->

            <!--{ ? goodsView['addGoods'] }-->
            //추가상품
            if(!goodsViewLayerController.add_goods_valid("#frmViewLayer"))
            {
                alert("{=__('필수 추가 상품을 확인해주세요.')}");
                return false;
            }
            <!--{ / }-->
            {customScript}

            var submitFl = true;
            if (isNaN(goodsTotalCnt)) goodsTotalCnt = 0;
            <!--{ ? goodsView['fixedSales'] == 'goods' }-->
            var perSalesCnt = goodsTotalCnt % salesUnit;

            if (perSalesCnt !== 0) {
                alert(__('%s개 단위로 묶음 주문 상품입니다.', salesUnit));
                submitFl = false;
            }
            <!--{ : }-->
            for (i in goodsOptionCnt) {
                if (isNaN(goodsOptionCnt[i])) goodsOptionCnt[i] = 0;
                var perSalesCnt = goodsOptionCnt[i] % salesUnit;

                if (perSalesCnt !== 0) {
                    alert(__('%s개 단위로 묶음 주문 상품입니다.', salesUnit));
                    submitFl = false;
                    break;
                }
            }
            <!--{ / }-->

            if (submitFl == true) {
                <!--{ ? goodsView['fixedOrderCnt'] == 'goods'}-->
                var fixedAlertString = '상품당';
                <!--{ / }-->
                <!--{ ? goodsView['fixedOrderCnt'] == 'option'}-->
                var fixedAlertString = '옵션당';
                <!--{ / }-->
                <!--{ ? goodsView['fixedOrderCnt'] == 'id' }-->
                var fixedAlertString = 'ID당';
                <!--{ / }-->

                <!--{ ? goodsView['fixedOrderCnt'] == 'goods' || goodsView['fixedOrderCnt'] == 'id' }-->
                <!--{ ? goodsView['fixedOrderCnt'] == 'goods' }-->
                if (minOrderCnt > 1 && goodsTotalCnt < minOrderCnt) {
                    alert(__('최소 구매 수량 미달 : ' + fixedAlertString + ' 최소 %s개 이상 구매가능합니다.', minOrderCnt));
                    submitFl = false;
                } else if (maxOrderCnt > 0 && goodsTotalCnt > maxOrderCnt) {
                    alert(__('최대 구매 수량 초과 : ' + fixedAlertString + ' 최대 %s개 이하 구매가능합니다.', maxOrderCnt));
                    submitFl = false;
                }
                <!--{ / }-->
                if (submitFl == true) {
                    <!--{ ? goodsView['fixedOrderCnt'] == 'id' }-->
                    //ajax로 id구매카운트 체크
                    var params = {
                            mode: 'check_memberOrderGoodsCount',
                            goodsNo: {=goodsView['goodsNo']},
                        };
                    $.ajax({
                        method: "POST",
                        async: false,
                        cache: false,
                        url: '../order/order_ps.php',
                        data: params,
                        success: function (data) {
                            // error 메시지 예외 처리용
                            if (!_.isUndefined(data.error) && data.error == 1) {
                                alert(data.message);
                                return false;
                            }

                            if (minOrderCnt > 1 && (goodsTotalCnt + data.count) < minOrderCnt) {
                                alert(__('최소 구매 수량 미달 : ' + fixedAlertString + ' 최소 %s개 이상 구매가능합니다.', minOrderCnt));
                                submitFl = false;
                            } else if (minOrderCnt > 1 && goodsTotalCnt < minOrderCnt) {
                                alert(__('최소 구매 수량 미달 : ' + fixedAlertString + ' 최소 %s개 이상 구매가능합니다.', minOrderCnt));
                                submitFl = false;
                            } else if (maxOrderCnt > 0 && (goodsTotalCnt + data.count) > maxOrderCnt) {
                                alert(__('최대 구매 수량 초과 : ' + fixedAlertString + ' 최대 %s개 이하 구매가능합니다.', maxOrderCnt));
                                submitFl = false;
                            } else if (maxOrderCnt > 0 && goodsTotalCnt > maxOrderCnt) {
                                alert(__('최대 구매 수량 초과 : ' + fixedAlertString + ' 최대 %s개 이하 구매가능합니다.', maxOrderCnt));
                                submitFl = false;
                            }
                        },
                        error: function (data) {
                            alert(data.message);
                            submitFl = false;
                        }
                    });
                    <!--{ / }-->
                }
                <!--{ : }-->
                for (i in goodsOptionCnt) {
                    if (isNaN(goodsOptionCnt[i])) goodsOptionCnt[i] = 0;
                    var perSalesCnt = goodsOptionCnt[i] % salesUnit;

                    if (minOrderCnt > 1 && goodsOptionCnt[i] < minOrderCnt) {
                        alert(__('최소 구매 수량 미달 : ' + fixedAlertString + ' 최소 %s개 이상 구매가능합니다.', minOrderCnt));
                        submitFl = false;
                        break;
                    } else if (maxOrderCnt > 0 && goodsOptionCnt[i] > maxOrderCnt) {
                        alert(__('최대 구매 수량 초과 : ' + fixedAlertString + ' 최대 %s개 이하 구매가능합니다.', maxOrderCnt));
                        submitFl = false;
                        break;
                    }
                }
                <!--{ / }-->
            }

            $('#optionViewLayer').find("input[name='goodsNo[]']").val('{goodsView['goodsNo']}');

            <!--{ ? page =='goods'}-->
            {=customCartEventScript}
            goods_option_view_result($( "#frmViewLayer" ).serialize(),"{optionInfo['sno']}");
            <!--{ : page == 'cart_tab_wish' || page == 'cart_tab_cart' }-->
            carttab_option_view_result($("#frmViewLayer").serialize(), "{optionInfo['sno']}");
            <!--{ : type == 'wish' }-->
            var params = $('#frmViewLayer').serializeArray();
            params.push({name: 'page', value: '{page}'});
            option_view_result(params, "{optionInfo['sno']}");
            <!--{ : }-->
            option_view_result($( "#frmViewLayer" ).serialize(),"{optionInfo['sno']}");
            <!--{ / }-->

            <!--{ ? type !='goods' }-->
            closeLayer();
            $("#optionViewLayer").html('');
            <!--{ / }-->
        });

        <!--{ ? optionInfo['optionSno'] }-->
        <!--{ ? goodsView['optionFl']== 'n' }-->
        var optionKey = $('#optionViewLayer').find("div[id*='option_display_item_0']");
        <!--{ : }-->
        goodsViewLayerController.option_price_display("#frmViewLayer");
        var optionKey = $('#optionViewLayer').find("div[id*='option_display_item_{optionInfo['optionSno']}']");
        <!--{ / }-->

        if($(optionKey).attr('id')) {
            optionKey = $(optionKey).attr('id').replace("option_display_item_", "");
            $("#frmViewLayer .goodsCnt_"+optionKey).val('{optionInfo['goodsCnt']}');

            <!--{ ? optionInfo['optionTextSno'] }-->
            <!--{ @ optionInfo['optionTextStr'] }-->
            var optionText = $("#frmViewLayer .optionTextDisplay{.key_}").find("input[name*='optionTextInput_']");
            $(optionText).val("{.value_}");
            <!--{ / }-->

            goodsViewLayerController.option_text_select($("#frmViewLayer input[name*='optionTextInput_']"));

            $("#frmViewLayer input[name*='optionTextInput_']").val('');
            <!--{ / }-->

            <!--{ @ optionInfo['addGoodsNo'] }-->
            $("#frmViewLayer select[name*='addGoodsInput']").each(function (key) {

                if($(this).find("option[value*='{.value_}']").length) {
                    $(this).find("option[value*='{.value_}']").attr("selected", "selected");
                    goodsViewLayerController.add_goods_select($("#frmViewLayer select[name='"+$(this).attr('name')+"']"));
                    $("#frmViewLayer .addGoodsCnt_"+optionKey + '_{.value_}').val('{optionInfo['addGoodsCnt'][.key_]}');
                    goodsViewLayerController.goods_calculate("#frmViewLayer",'',optionKey + '{=c.INT_DIVISION}{.value_}','{optionInfo['addGoodsCnt'][.key_]}');

                }

            });
            <!--{ / }-->

            <!--{ ? !optionInfo['optionTextSno'] && !optionInfo['addGoodsNo']  }-->
            goodsViewLayerController.goods_calculate("#frmViewLayer",1, optionKey,'{optionInfo['goodsCnt']}');
            <!--{ / }-->
        }
        <!--{ / }-->
        $('.target-delivery-add').on('click', function(){
            if ($(".delivery-add").is(":hidden"))	$(".delivery-add").removeClass('dn');
            else $(".delivery-add").addClass('dn');
        });

        $('.target-delivery-area').on('click', function(){
            if ($(".delivery-area").is(":hidden"))	$(".delivery-area").removeClass('dn');
            else $(".delivery-area").addClass('dn');
        });

    });

    /**
     * 총 합산
     */
    function total_calculate()
    {
        var goodsPrice = parseFloat($('#frmViewLayer input[name="set_goods_price"]').val());


        //총합계 계산
        goodsTotalCnt = 0;
        goodsOptionCnt = [];
        $('#frmViewLayer input[name*=\'goodsCnt[]\']').each(function (index) {
            goodsTotalCnt += parseFloat($(this).val());
            goodsOptionCnt[index] = parseFloat($(this).val());
        });
        var goodsTotalPrice = goodsPrice*goodsTotalCnt;


        var setOptionPrice =  0;


        $('#frmViewLayer input[name*="optionPriceSum[]"]').each(function () {
            setOptionPrice += parseFloat($(this).val());
        });

        var setOptionTextPrice =  0;
        $('#frmViewLayer input[name*="optionTextPriceSum[]"]').each(function () {
            setOptionTextPrice += parseFloat($(this).val());
        });


        var setAddGoodsPrice =  0;
        $('#frmViewLayer input[name*="add_goods_total_price["]').each(function () {
            setAddGoodsPrice += parseFloat($(this).val());
        });


        $('#set_option_price').val(setOptionPrice);
        $('#set_option_text_price').val(setOptionTextPrice);
        $('#set_add_goods_price').val(setAddGoodsPrice);

        var totalGoodsPrice = (goodsTotalPrice + setOptionPrice + setOptionTextPrice + setAddGoodsPrice).toFixed({currency.decimal});
        $('#frmViewLayer input[name="set_total_price"]').val(totalGoodsPrice);
        $('button.goods-cnt').attr('disabled', false);
        $('button.add-goods-cnt').attr('disabled', false);
    }


    //-->
</script>


<script type="text/html" id="optionTemplateLayer">
    <div id="option_display_item_<%=displayOptionkey%>" style="border-top:1px solid #dbdbdb;">
        <div class="check optionKey_<%=optionSno%>">
            <input type="hidden" name="goodsNo[]" value="{=goodsView['goodsNo']}">
            <input type="hidden" name="optionSno[]" value="<%=optionSno%>">
            <input type="hidden" name="goodsPriceSum[]" value="0">
            <input type="hidden" name="addGoodsPriceSum[]" value="0">
            <input type="hidden" name="displayOptionkey[]" value="<%=displayOptionkey%>">
            <!--{ ? couponUse == 'y' }-->
            <input type="hidden" name="couponApplyNo[]" value="">
            <input type="hidden" name="couponSalePriceSum[]" value="">
            <input type="hidden" name="couponAddPriceSum[]" value="">
            <!--{ / }-->
            <span class="name"><strong><%=optionName%><%=optionSellCodeValue%><%=optionDeliveryCodeValue%></strong>
                <!--{ ? couponUse == 'y' }-->
                <!--{ ? gd_is_login() === false }-->
                <button type="button" class="btn-alert-login"><img src="../img/btn/coupon-apply.png" alt="{=__('쿠폰적용')}"/></button>
                <!--{ : }-->
                <span id="coupon_apply_<%=displayOptionkey%>"><a href="#couponApplyLayer" class="btn-open-layer" data-key="<%=displayOptionkey%>"><img src="../img/btn/coupon-apply.png" alt="{=__('쿠폰적용')}"/></a></span>
                <!--{ / }-->
                <!--{ / }-->
                <span id="option_text_display_<%=displayOptionkey%>"></span></span>

            <div class="price">
                <span class="count">
                <input type="text" class="text goodsCnt_<%=displayOptionkey%>" title="{=__('수량')}" name="goodsCnt[]" value="{=gd_isset(goodsView['defaultGoodsCnt'])}" data-value="{=gd_isset(goodsView['defaultGoodsCnt'])}"  data-stock="<%=optionStock%>" data-key="<%=displayOptionkey%>" onchange="goodsViewLayerController.input_count_change(this,'1');return false;">
                <span>
                <button type="button" class="up goods-cnt" title="{=__('증가')}"  value="up{=c.STR_DIVISION}<%=displayOptionkey%>">{=__('증가')}</button>
                <button type="button" class="down goods-cnt" title="{=__('감소')}"  value="dn{=c.STR_DIVISION}<%=displayOptionkey%>">{=__('감소')}</button>
                </span>
                </span>
                <em><input type="hidden" value="<%=optionPrice%>" name="option_price_<%=displayOptionkey%>"><input type="hidden" value="0" name="optionPriceSum[]" >{=gd_global_currency_symbol()}<strong class="option_price_display_<%=displayOptionkey%>"><%=optionPrice%></strong>{=gd_global_currency_string()}</em>
            </div>
            <div class="del">
                <button type="button" class="delete-goods" title="{=__('삭제')}" data-key="option_display_item_<%=displayOptionkey%>" >{=__('삭제')}</button>
            </div>
        </div>
    </div>
</script>

<script type="text/html" id="addGoodsTemplateLayer">
    <div id="add_goods_display_item_<%=displayOptionkey%>_<%=displayAddGoodsKey%>" class="check" >
    <span class="name"><%=addGoodsimge%>
    <input type="hidden" name="addGoodsNo[<%=optionIndex%>][]" value="<%=optionSno%>" data-group="<%=addGoodsGroup%>">
    <%=addGoodsName%>
    </span>
        <div class="price">
    <span class="count">
    <input type="text" class="text addGoodsCnt_<%=displayOptionkey%>_<%=displayAddGoodsKey%>" title="{=__('수량')}" name="addGoodsCnt[<%=optionIndex%>][]" value="1"  data-key="<%=displayOptionkey%>{=c.INT_DIVISION}<%=displayAddGoodsKey%>" data-stock-fl="<%=addGoodsStockFl%>"  data-stock="<%=addGoodsStock%>"  onchange="goodsViewLayerController.input_count_change(this);return false;">
    <span>
    <button type="button" class="up add-goods-cnt" title="{=__('증가')}"  value="up{=c.STR_DIVISION}<%=displayOptionkey%>{=c.INT_DIVISION}<%=displayAddGoodsKey%>">{=__('증가')}</button>
    <button type="button" class="down add-goods-cnt" title="{=__('감소')}"   value="dn{=c.STR_DIVISION}<%=displayOptionkey%>{=c.INT_DIVISION}<%=displayAddGoodsKey%>">{=__('감소')}</button>
    </span>
    </span>
            <em><input type="hidden" value="<%=addGoodsPrice%>" name="add_goods_price_<%=displayOptionkey%>_<%=displayAddGoodsKey%>"><input type="hidden" name="add_goods_total_price[<%=optionIndex%>][]" value="" >{=gd_global_currency_symbol()}<strong class="add_goods_price_display_<%=displayOptionkey%>_<%=displayAddGoodsKey%>"></strong>{=gd_global_currency_string()}</em>
        </div>
        <div class="del">
            <button type="button" class="delete-add-goods" title="{=__('삭제')}" data-key="<%=displayOptionkey%>-<%=displayAddGoodsKey%>">{=__('삭제')}</button>
        </div>
    </div>
</script>
