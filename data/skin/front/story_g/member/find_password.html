{*** 비밀번호 찾기 | member/find_password.php ***}
{ # header }

<div class="member find-pw-page">
    <h2>{=__('비밀번호 찾기')}</h2>

    <div class="box">
        <form name="formFind" id="formFind" action="../member/user_certification.php" method="post">
            <fieldset>
                <legend>{=__('비밀번호 찾기 폼')}</legend>
                <h3>{=__('아이디 입력')}</h3>

                <p class="guide">{=__('비밀번호를 찾고자 하는 아이디를 입력해 주세요.')}</p>

                <div class="find-pw">
                    <div class="input-id">
                        <div class="txt-field">
                            <input type="text" id="memberId" name="memberId" class="text" placeholder="{=__('아이디')}">
                        </div>
                        <div class="txt-field" style="margin-top: 10px;">
                            <input type="text" id="memberName" name="memberName" class="text" placeholder="{=__('이름')}">
                        </div>
                        <p>{=__('아이디를 모르시나요?')}<a href="#" class="btn-find-id">{=__('아이디 찾기')}</a></p>
                        <p class="dn" id="errorMessage"></p>
                    </div>
                </div>
                <div class="btn">
                    <button class="skinbtn base3 fp-next" type="submit"><em>{=__('다음')}</em></button>
                </div>
            </fieldset>
        </form>
    </div>
</div>
<hr/>
<script type="text/javascript">
    $(document).ready(function () {
        var sleepFl = false;
        $('input').keyup(function () {
            $('#errorMessage', 'form').addClass('dn');
        });

        $('.btn-find-id').click(function (e) {
            location.href = '../member/find_id.php';
            e.preventDefault();
        });

        $('#formFind button[type="submit"]').click(function () {
            if ($('#formFind').valid() == false) return false;
        });

        $('#formFind').validate({
            dialog: false,
            rules: {
                memberId: {
                    required: true
                },
                memberName: {
                    required: true
                }
            },
            messages: {
                memberId: {
                    required: "{=__('아이디를 입력해주세요')}"
                },
                memberName: {
                    required: "{=__('이름을 입력해주세요')}"
                }
            }, submitHandler: function (form) {
                var data = $(form).serializeArray();
                data.push({name: "mode", value: "find_member"});

                $.post('../member/find_ps.php', data).done(function (data, textStatus, jqXHR) {
                    console.log('gd_member ajax', data, textStatus, jqXHR);
                    var code = data.code;
                    var message = data.message;
                    if (_.isUndefined(code) && _.isUndefined(message)) {
                        form.submit();
                    } else {
                        if(message == 'normal'){
                            alert(__('휴면회원으로 전환된 아이디입니다. 휴면회원 해제 후 비밀번호 찾기가 가능하오니, 고객센터로 문의해주세요.'));
                        }else{
                            if(sleepFl){
                                alert(__('휴면회원 해제 후 비밀번호 찾기가 가능합니다. '));
                            }
                            $('#errorMessage', form).removeClass('dn').html('<strong>' + message + '</strong>');

                            if (message != '회원정보를 찾을 수 없습니다.') {
                                sleepFl = true;
                            }
                        }
                    }
                });
            }
        });
    });
</script>
{ # footer }
